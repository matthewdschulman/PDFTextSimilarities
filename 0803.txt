Quadratic Programming and Impedance Control
for Transfemoral Prosthesis
Huihua Zhao, Shishir Kolathaya and Aaron D. Ames
Abstract— This paper presents a novel optimal control
strategy combining control Lyapunov function (CLF) based
quadratic programs with impedance control, with the goal
of improving both tracking performance and the stability
of controllers implemented on transfemoral prosthesis. CLF
based quadratic programs have the inherent capacity to op-
timally track a desired trajectory. This property is used in
congruence with impedance control—implemented as a feed-
forward term—to realize signiﬁcantly small tracking errors,
while simultaneously yielding bipedal walking that is both stable
and robust to disturbances. Moreover, instead of experimentally
validating this on human subjects, a virtual prosthesis is
attached to a robotic testbed, AMBER. The authors claim that
the walking of AMBER is human like and therefore form a
suitable substitute to human subjects on which a prosthetic
control can be tested. Based on this idea, the proposed controller
was ﬁrst veriﬁed in simulation, then tested on the physical robot
AMBER. The results indicate improved tracking performance,
stability, and robustness to unknown disturbances.
I. INTRODUCTION
As one of the most important applications of bipedal
robotic research, the development of lower-limb prosthetic
devices and controllers for these devices has garnered the
attention of the control and robotics communities in recent
years [10], [19], [20]. Different control strategies have been
utilized for the control of transtibial and transfemoral pros-
thetic devices. Control based on gait-pattern generators has
been realized in [17], [12]. Motion intent recognition with
position control is successfully implemented in [10]. With the
assumption that human gait is cyclical, impedance control is
also one of the common approaches [9], [11], [19].
Inspired by the large body of work related to bipedal
robotic locomotion and control implementation on prosthe-
sis, there are three basic biomechanical requirements that
must be satisﬁed for a transtibial or transfemoral prosthesis
[18], [21]: (1) the prosthetic device must support the body
weight of the amputee during the stance phase, i.e., the pros-
thesis control should provide “stability” during the weight
bearing phase; (2) the physical interface between the able
body and the prosthesis must prevent undesirable pressure
during locomotion. That is to say, the prosthetic controller
must be “torque” optimal for the amputees wearing the
device; (3) the prosthesis must mimic as nearly as possible
the kinematics and dynamics of the normal gait. The amputee
should be able to walk with normal appearance as the healthy
people do.
*This research is supported by NASA grant NNX11AN06H, NSF grants
CNS-0953823 and CNS-1136104.
H. Zhao, S. Kolathaya and A. Ames are with the department of Mechan-
ical Engineering, Texas A & M University, 3128 TAMU, College Station,
USA huihuazhao,shishirny,aames@tamu.edu
The objective of this paper is to address requirements
(1) and (3) indicated above, which is achieved through the
following two contributions. First, we introduce the idea of
using bipedal robots to test prosthetic controllers—a nominal
walking gait is found for the robot that is human-like, and
prosthetic controllers can be tested on a “prosthetic” leg
of the robot. Through this method, we are able to present
and test the second contribution of this work—a novel
transfemoral prosthesis control method: control Lyapunov
function (CLF) based quadratic programs (QPs) coupled with
impedance control. In particular, we present a Model Inde-
pendent QP (MIQP) utilizing CLFs to generate the feedback
component of the controller and leverage impedance control
to generate a robust feed-forward term.
Before introducing our novel prosthetic control strategy—
CLF based MIQP—we ﬁrst present one of the two major
novel aspects of this paper: a method for testing prosthetic
controllers via bipedal robots that display human-like loco-
motion. This allows for the collection of useful information
regarding the performance of prosthetic control strategies to
be gathered from the robot without the need for evasive tests
on an amputee. Guided by this idea, the control strategy
can be ﬁrst designed and veriﬁed in simulation. With the
model information of the physical robot, the essential control
parameters can also be learned through simulation [3]. Then,
a physical robot that has been shown to display qualitatively
human-like walking, “wearing” a prosthetic device, can be
used as a platform to test and polish the design of both the
prosthesis controller and the prosthetic device.
With the idea of using a robot as the test platform for
prosthetic control, we ﬁrst show that we are able to achieve
a robot walking with a prosthetic device using impedance
control in both simulation and experiment. Based loosely on
the deﬁnition of impedance control, ﬁrst proposed by Hogan
[13], the torque at each joint during a single step cycle can be
represented by a series of passive impedance functions [19].
By reproducing this torque at the prosthetic device joint using
the passive impedance functions, one can obtain a similar
prosthetic gait compared to that found in normal gait tests.
Normally, hand tuning from an expert is required to obtain
the impedance parameters [8], [16], which, therefore, leads
to another disadvantage—it is not optimal. Considering all
the drawbacks of impedance control, the obtained tracking
performance is lacking, resulting in walking that is not as
robust as desired.
Utilizing the impedance controller as a feed-forward term,
we present a novel control method that will be utilized for
feedback to increase robustness and stability. In particular,
2014 IEEE International Conference on Robotics & Automation (ICRA)
Hong Kong Convention and Exhibition Center
May 31 - June 7, 2014. Hong Kong, China
978-1-4799-3684-7/14/$31.00 ©2014 IEEE 1341
Fig. 1: The biped robot AMBER (left) and the angle con-
ventions (right). The right leg with red dash line denotes the
prosthetic device; the red dash circle represents the prosthesis
joint that will be controlled using prosthetic controller.
we begin by considering rapidly exponentially stabilizing
control Lyapunov functions (RES-CLFs) as introduced in
[6]. This class of CLFs can naturally be stated as inequality
constraints in torque such that, when satisﬁed, rapid expo-
nential convergence of the error is formally guaranteed. Fur-
thermore, these inequality constraints can naturally be solved
in an optimal fashion through the use of quadratic programs.
The end result is a CLF based QP as ﬁrst introduced in
[5]. Finally, due to the special structure of the RES-CLFs
that will be considered in this paper, the CLF based QP can
be stated in a model independent fashion. The end result is
a novel feedback control methodology: Model Independent
Quadratic Programs (MIQP) based upon RES-CLFs. These
are combined with impedance control to obtain the ﬁnal
prosthetic controller. With the proposed controller, we will
show that the tracking performance can be improved in both
simulation and experiment. In addition, utilizing this novel
control method, the robot displays improved stability and
robustness to unknown disturbances.
The structure of this work is as follows. Both the mathe-
matical modeling and the physical model of the robot AM-
BER are introduced in Sec. II. The controller constructions of
the impedance control and the CLF based MIQP control are
discussed in Sec. III. Simulation results, including robustness
tests by using different controllers will be showed in Sec. IV.
Finally, the experimental results are presented on Sec. V.
Discussion and conclusion will be made in Sec. VI.
II. ROBOT MODEL
In this section, we start with a short description about
the mathematical hybrid system models of bipedal robots.
The physical robot, AMBER, which will be used as the test
platform, is introduced at the end.
A. Robotic Model
Since the walking of bipedal robot displays both contin-
uous and discrete dynamics, we formally represent it as a
hybrid system (see [4] for a formal deﬁnition).
Continuous Dynamics. The conﬁguration space of the
robot Q
R
is described in body coordinates as: q =
(q
sf
;q
sk
;q
sh
;q
nsh
;q
nsk
)
T
2R
5
, which are shown in Fig. 1.
With the mass and length properties corresponding to the
physical robot AMBER [22], the equations of motion for
the robot are given using the Euler-Lagrange formula:
D(q)
¨
q+H(q;
˙
q)=Bu; (1)
where D(q)2R
55
is the inertial matrix including the
inertia of the boom; B2R
54
is the torque map with the
consideration of underactuation, and u2R
41
, is the vector
of torque inputs. Note that, since AMBER has DC motors
with small inductances, we can realize the electromechanical
system with voltage inputs which have the following form:
V
in
=R
a
i
a
+K
w
w; (2)
whereV
in
2R
41
is the vector of voltage inputs to the motors,
i
a
2R
41
is the vector of currents through the motors, R
a
2
R
44
is the resistance matrix, and w2R
41
is the vector of
motor speed which has the relation as w =r
m
˙
q with r
m
2
R
44
denoting the total reduction of the system. Since the
motors are controlled individually, with the torque constant
K
j
2R
44
, the applied torques are:
u=K
j
R
 1
a
(V
in
 K
w
w): (3)
Thus, the Euler-Lagrange equation can be reformulated as:
D(q)
¨
q+H
v
(q;
˙
q)=B
v
V
in
; (4)
where H
v
(q;
˙
q)=H(q;
˙
q)+K
j
R
 1
a
K
w
w and B
v
=BK
j
R
 1
a
.
Manipulation of (4) yields the afﬁne control system (f;g),
details of which can be found in [4].
Discrete Dynamics. A discrete impact occurs instanta-
neously when the swing foot hits the ground. As a result,
the velocities of the robot will change, combining with a leg
switch simultaneously. Impacts are assumed to be plastic as
in [14], and the resulting reset map D
R
is:
D
R
(q;
˙
q)=

D
q
q
D
˙
q
(q)
˙
q

; (5)
where D
q
is the relabeling which switches the stance and
non-stance leg at impact, and D
˙
q
(q) determines the change
in velocities due to the impact [4].
B. AMBER Test Platform
AMBER (short for A&M Bipedal Experimental Robot) is
a planar bipedal robot with 5 links (one torso, two thighs and
two calves, see Fig. 1). With pointed feet conﬁguration, AM-
BER is powered by 4 DC motors and is thus underactuated at
the ankles. Applying the human-inspired voltage controller,
AMBER has achieved stable and human-like walking in
experiment [22]. In this work, we use AMBER as the
platform to test the proposed prosthetic controller. The right
calf is assumed to be the “prosthetic device” which has the
same length and mass conﬁguration of the left calf that is
marked as “healthy leg”. The proposed controller will be
used on the prosthetic device, i.e., on the right knee joint.
The controller for the remaining actuators will still use the
original voltage P controller discussed in [22].
1342
Heel Lift Full Knee Flexion Heel Strike Mid Stance Heel Lift
P2 P3 P4 P1
t
Fig. 2: AMBER gait phase separation. The red line represents
the prosthetic device and the solid lines denote the able body.
The green line is the knee angle of one full gait cycle.
III. CONTROLLER CONSTRUCTION
In this section, we will introduce the idea of impedance
control brieﬂy and then extend it to voltage impedance to ac-
commodate the control of AMBER. Due to the shortcomings
of impedance control, we propose the innovative CLF [6]
based model independent quadratic programming (MIQP)
control as the feedback term while using the impedance
control as the feed-forward input.
A. Impedance Control for Prosthesis
Impedance Control. Based on the notion of impedance
control ﬁrst proposed by Hogan [13], the torque at each
joint during a single step can be piecewisely represented by
a series of passive impedance functions [19] with the form:
t =k(q q
e
)+b
˙
q; (6)
where, k, q
e
and b represent the stiffness, equilibrium angle
and damping respectively, which are constant for speciﬁc
phase. This formula only requires local information about
the controlled prosthetic joint—in this case the right knee
joint (q
RK
;
˙
q
RK
)—so the end result is a simple prosthesis
control. In particular, since the direct control input is voltage
in AMBER, we can represent the joint input voltage during
a single step by this function piecewisely with the form:
V
imp
p
=k(q q
e
)+b
˙
q; (7)
where V
imp
p
is termed the impedance voltage.
Phase Separation. While impedance control with a ﬁnite
state machine is one of the most widely used algorithms
suggested to date [15], one main problem is to identify the
phases correctly during a single step.
Based on the previous work [3], even though a point
feet model is considered, analysis of AMBER walking data
shows that one gait cycle can be divided into four phases
based on the prosthesis knee joint, which are denoted as
p=f1;2;3;4g, as shown in Fig. 2. Speciﬁcally, each phase
begins at time t
p
0
and ends at t
p
f
. The phase separation
principle is similar to that in [3] but with values speciﬁc
to the gait of AMBER. Therefore, in each phase p, the
dynamics of the biped system can be stated as:
(
D(q)
¨
q+H
v
(q;
˙
q)=B
v
V
in
8t2[t
p
0
;t
p
f
];
(q(t
p
0
);
˙
q(t
p
0
))=R(q(t
p
f
);
˙
q(t
p
f
)):
(8)
where p  1 is set to 4 if p= 1 and the switching function
R has been deﬁned as follows:
R(q(t);
˙
q(t))=
(
D(q(t);
˙
q(t)) at impacts;
(q(t);
˙
q(t)) otherwise:
(9)
Speciﬁcally, for the prosthesis joint, we will replace the
corresponding V
in
term (denoted as V
in;p
) with the prosthetic
voltage input V
imp
p
, which can be represented as:
V
in;p
:=V
imp
p
=k
p
(q
RK
(t) q
e
p
)+b
p
˙
q
RK
(t); (10)
where q
RK
(t) and
˙
q
RK
(t) denote angle and angular velocity
of the right knee at time t. The end result is the following
construction for the prosthetic joint:
D
j
(q)
¨
q+H
j
v
(q;
˙
q)=V
in;p
8t2[t
p
0
;t
p
f
]; (11)
wherei indicates thei
th
row of the corresponding term, which
will be updated according to the phase p. Note that, since
we deﬁne the body coordinates based on the stance and non-
stance nomenclature, we have i= 5 when p= 1;2, i.e., the
prosthetic device is the non-stance leg, and i= 2 while p=
3;4, i.e., the prosthetic device is the swing leg.
Impedance Parameter Estimation. With the phase transi-
tions deﬁned above, another problem of impedance control
is to identify the control parameters for each phase. In the
previous work [3], the authors showed that the impedance
parameters for a lower-limb prosthesis can be learned by
the observation of unimpaired human walkers. The results
have been validated both in simulation and in experiment
with a transfemoral prosthetic device. In this work, instead
of using the experimental data from the robot, we extend the
method to estimate the impedance parameters by observing
the simulated “unimpaired” walking data of AMBER.
Through the use of human-inspired optimization and the
essential model recovery algorithm to characterize the actual
physical model, the estimation algorithm does not require
experimental data, as a result, can potentially save the
difﬁculty of experimental tuning of the devices. The esti-
mated impedance parameters are shown in Table I, and the
estimation algorithm is omitted here due to space constraints.
B. CLF Model Independent QP
In this part, a brief revisit of human-inspired control will
be given ﬁrst (additional details can be found in [23]).
Based on this foundational work and inspired by the CLF
controller in [6], we will discuss the novel CLF based model
independent control in detail.
Human-Inspired Control Revisit. Motivated by the goal
of achieving human-like bipedal robotic walking, human-
inspired control aims to drive the actual robot outputs y
a
(q),
which are functions of joint angles, to the desired human out-
putsy
d
(t;a)that can be represented by thecanonicalwalking
1343
function (CWF) introduced in [4]. Therefore, motivating the
introduction of human-inspired outputs:
y(q;
˙
q)=

y
1
(q;
˙
q)
y
2
(q)

=

y
a
1
(q;
˙
q) v
hip
y
a
2
(q) y
d
2
(t(q);a)

; (12)
where a is the set of parameters of CWF and t(q) is
the parameterized time. y
1
(q;
˙
q) is the relative degree one
output, which is the difference between the actual forward
hip velocity y
a
1
(q;
˙
q) and the desired hip velocity v
hip
. y
2
(q)
are the relative degree two human-inspired outputs which
are the differences between the actual outputs y
a
2
(q) and the
desired outputs y
d
2
(t(q);a).
With this in hand, the dynamics in (4) can be obtained as:

˙ y
1
¨ y
2

=

L
f
y
1
(q;
˙
q)
L
2
f
y
2
(q;
˙
q)

| {z }
L
f
+

L
g
y
1
(q;
˙
q)
L
g
L
f
y
2
(q;
˙
q)

| {z }
A
u; (13)
where L
f
is the Lie derivative and A is dynamic decoupling
matrix, which is nonlinear in most cases. By picking:
u=A
 1
(L
f
+m); (14)
the equation (13) turns into the linear form:

˙ y
1
¨ y
2

=m: (15)
By designing m properly, [4] for example, one can drive both
y
1
! 0 and y
2
! 0 exponentially; as a result, human-inspired
walking can be achieved.
This control strategy works for nonlinear systems, but
requires good knowledge about the model. In the domain of
complex nonlinear robotic control, this assumption is usually
not satisﬁed, and therefore yields the computed torque to be
far away from the required torque. PID control still domi-
nates in real world control problems since it does not require
accurate model information, i.e., it is model independent.
However, considering all the well-known problems of PID
control (hand tuning, none optimal [7]), we are motivated
to ﬁnd a new optimal control strategy to overcome these
issues while maintaining the model insensitiveness property.
To achieve this goal, the approach of this work will be
introduced as follows.
CLF MIQP. By deﬁning the vector h = (y; ˙ y)
T
2R
21
,
equation (15) can be reformulated as:
˙ h =

0 1
0 0

| {z }
F
h+

0
1

|{z}
G
m: (16)
In the context of this control system, we consider the
continuous time algebraic Riccati equation with P=P
T
> 0:
F
T
P+PF PGG
T
P+I= 0; (17)
that yields the optimal solution m = G
T
Ph.
With the aim to have stronger bounds of the convergence
of the considered hybrid system, we take this method further
by deﬁning h
e
= (y=e; ˙ y)
T
. We then choose P and e >
0 carefully to construct a rapidly exponentially stabilizing
control Lyapunov function (RES-CLF) that can be used to
stabilize the system in a rapidly exponentially fashion [6].
Particularly, we deﬁne the positive deﬁnite CLF as:
V
e
(h)=h
T

1
e
I 0
0 I

P

1
e
I 0
0 I

h :=h
T
P
e
h: (18)
Differentiating this function renders:
˙
V
e
(h)=L
f
V
e
(h)+L
g
V
e
(h)m; (19)
where L
f
V
e
(h)=h
T
(F
T
P
e
+P
e
F)h, L
g
V
e
(h)= 2h
T
P
e
G.
In order to exponentially stabilize the system, we want to
ﬁnd m such that, for speciﬁcally picked g > 0 [6], we have:
L
f
V
e
(h)+L
g
V
e
(h)m 
g
e
V
e
(h): (20)
Therefore, an optimal m could be found by solving the
following minimization problem:
m(h)= argminfjjmjj :j
0
(h)+j
1
(h)m 0g; (21)
which is equivalent to solving the quadratic program (QP):
m(h)= argmin
m2R
n
1
+n
2
m
T
m (22)
s:t j
0
(h)+j
1
(h)m 0; (CLF)
where j
0
(h)=L
f
V
e
(h)+
g
e
V
e
(h) and j
1
(h)=L
g
V
e
(h). n
1
,
n
2
correspond to the number of relative degree one outputs
and relative degree two outputs. In this case, we have n
1
= 0
and n
2
= 1 since we are only considering the knee joint.
Note that, instead of substituting the optimal solution m
into equation (14) to obtain the feedback control law as in
[6], we use m directly as control input into the original
system without considering the model decoupling matrix
A and L
f
. Therefore, we term this control strategy model
independent quadratic program (MIQP) controller.
Taking a further look into the MIQP algorithm, we ba-
sically constructed a new linear control system (16) that
only focuses on the errors between the actual outputs and
desired outputs, while not requiring any information about
the original model. Another immediate advantage is that the
torque bounds can be directly applied in this formulation
where, the optimal control value can be obtained while
respecting the torque bounds. As discussed in [5], this can
be achieved by relaxing the CLF constraints with a large
penalty value r > 0. In particular, we consider the MIQP as:
argmin
(d;m)2R
n
1
+n
2
+1
rd
2
+m
T
m (23)
s:t j
0
(h)+j
1
(h)md; (CLF)
mm
MAX
; (Max Torque)
 mm
MAX
: (Min Torque)
Similarly, m can be replaced with the voltage V
qp
directly
without affecting the conﬁguration of this algorithm.
MIQP+Impedance Control. Utilizing the formal frame-
work discussed above, we are now ready to introduce another
main result of this paper, which is the MIQP+Impedance
controller for prosthesis control.
1344
While MIQP control beneﬁts from its model independence
property in an optimal fashion, it also suffers from the
overshoot problem as the PID controller does because of
the lack of model information. Particularly, this issue can
be a fatal problem for a prosthesis controller with the
safety consideration of the amputee; therefore, this motivates
the introduction of MIQP+Impedance control. With the
impedance control V
imp
p
as the feed-forward term, the input
voltage of the prosthetic leg V
in;p
in (11) can be stated as:
V
in;p
=V
qp
+V
imp
p
with V
qp
the voltage computed from the
MIQP problem. To take a further step, we add the impedance
term V
imp
p
into the MIQP construction, which yields the
following MIQP+Impedance problem:
argmin
(d;V
qp
)2R
2
rd
2
+V
qpT
V
qp
(24)
s:t j
0
(h)+j
1
(h)V
qp
d+j
1
(h)V
imp
p
; (CLF)
V
qp
V
qp
MAX
; (Max QP V oltage)
 V
qp
V
qp
MAX
; (Min QP V oltage)
V
qp
V
MAX
 V
imp
p
; (Max Input V oltage)
 V
qp
V
MAX
+V
imp
p
: (Min Input V oltage)
By adding the impedance feed-forward term into the QP
problem, the model independent control gathers model infor-
mation, therefore can adjust the V
qp
accordingly to accom-
modate the feed-forward term in order to achieve exceptional
tracking. By setting the QP voltage bounds V
qp
MAX
, we can
limit the overshoot problem. Note that, we also set the total
input voltage bounds for the QP problem such that the ﬁnal
total optimal input voltageV
in;p
will satisfy the input voltage
bounds which are constrained by the hardware.
IV. PROSTHETIC WALKING IN SIMULATION
With the control architecture in hand, the simulation
results of AMBER will be discussed in this section. The
tracking results of the prosthesis joint by using different con-
trollers will be compared. Finally, robustness tests will also
be performed and compared with using different controllers.
A. Tracking Performance with Different Controllers
With the exception of the prosthesis joint, on which dif-
ferent controllers will be implemented, the remaining joints
will be controlled with the human-inspired voltage P control.
Three different controllers are tested as the prosthetic con-
troller: P control, impedance control and MIQP+Impedance
control. Fig. 6 shows the tracking performances of the
prosthesis knee joint using these three controllers. Using
the tracking results of P control as the nominal reference
as shown in Fig. 6a, we can see that the MIQP+Impedance
control improves the tracking performance for both stance
and non-stance phases by more than 10 times w.r.t the RMS
error, while impedance control yields worse tracking results.
The phase portrait for 32 steps with utilizing voltage P
control can be seen in Fig. 3, which clearly shows the
convergence to one periodic orbit since the controls are same
on both of the legs. The phase portrait for 64 steps with
using MIQP+Impedance can be seen in Fig. 4, showing
0.24 0.26 0.28 0.3 0.32 0.34 0.36 0.38 0.4 0.42
?1
?0.5
0
0.5
1
1.5
Angle (rad)
Angular Velocity (rads/s)
 
 
?
sk
0.3 0.4 0.5 0.6 0.7 0.8 0.9 1 1.1
?5
?4
?3
?2
?1
0
1
2
3
Angle (rad)
Angular Velocity (rads/s)
 
 
?
nsk
Fig. 3: Phase portrait of prosthesis joint with voltage control
0.25 0.3 0.35 0.4
?1
?0.5
0
0.5
1
1.5
Angle (rad)
Angular Velocity (rads/s)
 
 
?
sk
0.3 0.4 0.5 0.6 0.7 0.8 0.9 1 1.1
?5
?4
?3
?2
?1
0
1
2
3
Angle (rad)
Angular Velocity (rads/s)
 
 
?
nsk
Fig. 4: Phase portrait of prosthesis joint with
MIQP+Impedance control
that the phase portrait converges to two limit cycles since
the controllers are asymmetric. The simulation gait tiles
of two steps walking with using both impedance control
and MIQP+Impedance control are shown in Fig. 7 and
Fig. 8, respectively. Note that, the robot can only walk 12
steps with only impedance control in simulation. This is
reasonable since we consider underactuated ankles in this
work. Impedance control is fundamentally passive and not
able to correct tracking errors efﬁciently, therefore, any small
error in tracking may lead to a failure to walk.
With the comparisons above, we can conclude that
MIQP+Impedance controller delivers improved tracking per-
formance without increasing the torque requirement, which
is the key perspective while evaluating a prosthetic controller.
B. Stability Testing
Stability is another fundamental requirement for a prosthe-
sis controller. With the proposed MIQP+Impedance control,
we claim that this controller renders more robustness than
just impedance control, and therefore is safer for the am-
putee’s daily use. Two robustness tests are applied to the
robot in simulation; one is to add an instantaneous push and
another one is to let the robot walk above an obstacle.
Reaction to impulse push. A 2N impulse force (lasting
for 0:05s) has been applied to the prosthetic leg while
Fig. 5: Gait tiles of walking over an obstacle with
MIQP+Impedance control.
1345
0 0.2 0.4 0.6
0.2
0.4
0.6
0.8
1
1.2
Time (s)
Angle (rads)
 
 
Sknee RMS Error: 0.0149
NSknee RMS Error: 0.0523
?
a, volt
sk
 
 
?
d, volt
sk
 
 
?
a, volt
nsk
 
 
?
d, volt
nsk
(a) Simulated voltage control
0 0.5 1
0.2
0.4
0.6
0.8
1
1.2
Time (s)
Angle (rads)
 
 
Sknee RMS Error: 0.0864
NSknee RMS Error: 0.1539
?
a, volt
sk
 
 
?
d, volt
sk
 
 
?
a, volt
nsk
 
 
?
d, volt
nsk
(b) Experiment voltage control
0 0.2 0.4 0.6
0.2
0.4
0.6
0.8
1
1.2
Time (s)
Angle (rads)
 
 
Sknee RMS Error: 0.0258
NSknee RMS Error: 0.1447
?
a, imp
sk
 
 
?
d, imp
sk
 
 
?
a, imp
nsk
 
 
?
d, imp
nsk
(c) Simulated impedance control
0 0.5 1
0.2
0.4
0.6
0.8
1
1.2
Time (s)
Angle (rads)
 
 
Sknee RMS Error: 0.1902
NSknee RMS Error: 0.1792
?
a, imp
sk
 
 
?
d, imp
sk
 
 
?
a, imp
nsk
 
 
?
d, imp
nsk
(d) Experiment impedance control
0 0.1 0.2 0.3 0.4 0.5
0.2
0.4
0.6
0.8
1
1.2
Time (s)
Angle (rads)
 
 
Sknee RMS Error: 0.001
NSknee RMS Error: 0.0017
?
a, impqp
sk
 
 
?
d, impqp
sk
 
 
?
a, impqp
nsk
 
 
?
d, impqp
nsk
(e) Simulated MIQP+Imped control
0 0.5 1
0
0.2
0.4
0.6
0.8
1
1.2
Time (s)
Angle (rads)
 
 
Sknee RMS Error: 0.0602
NSknee RMS Error: 0.1049
?
a, impqp
sk
 
 
?
d, impqp
sk
 
 
?
a, impqp
nsk
 
 
?
d, impqp
nsk
(f) Experiment MIQP+Imped control
Fig. 6: Actual and desired outputs of the prosthesis knee
joint with different controllers in both simulation (left) and
experiment (right).
it’s in the swing phase. From the video [1], we can see
that the prosthetic device with the proposed controller can
tolerate this disturbance and maintain good tracking. We also
tested the same disturbance when using only the impedance
controller; the tracking error becomes bigger due to the
disturbance and the robot falls after 6 steps.
To overcome an obstacle. In the simulation, we let the robot
walk over a 20 mm height obstacle. The gait tiles can be
seen in Fig. 5, showing that the robot can overcome the
obstacle smoothly. A similar test is also conducted with only
impedance control. The robot can walk over the obstacle,
however, the tracking performance becomes worse. Both the
tests are shown in the video [1] with details.
TABLE I: Impedance Parameters of the Prosthesis.
Sim/Exp Estimated parameters Experimental parameters
Phase k
p
[V] b
p
[Vs] q
e
p
[rad] k
p
[V] b
p
[Vs] q
e
p
[rad]
P1 -3.9731 0.1242 0.2493 -12.9731 0.0242 0.1283
P2 -3.7714 0.1499 0.2327 -18.7714 0.0499 0.1
P3 -0.2123 0.1405 1.1378 -15.212 0.1405 1.1405
P4 -0.1956 0.1418 0.1999 -18.5568 0.0044 0.1024
V. EXPERIMENTAL IMPLEMENTATION AND
RESULTS
In this section, the controllers are tested on the physical
robot AMBER. The experiments show similar results as in
simulation—that is, the MIQP+Impedance controller yields
better tracking performance and more robustness.
A. Impedance Control
Starting with the estimated impedance parameters obtained
from simulation, we are able to tune the parameters within
a small range and get sustainable walking by only using
the impedance controller. The actual impedance parameters
used on the robot are shown in Table I. Note that, the actual
impedance parametersk
p
are bigger than the estimated values
and the impedance parameters b
p
are tuned to be low. The
main reasons are twofold. Firstly, in simulation, the friction
and damping of the transmission, i.e., the motor and gear
box, are not considered. Therefore, higher k
p
parameters are
required to compensate for the model differences. The second
reason is that the angular velocity information from AMBER
is not accurate, bordering being unusable, which prevents
the use of the velocity terms. Therefore, b
p
terms has to be
lowered, which, as a result, leads to higher k
p
parameters in
order to provide enough torque.
Besides the discussion above, we claim that the estimated
impedance parameters can capture the essentials of the
physical model, thus the requirement of hand tuning can be
kept to minimum. The tracking result of using impedance
controller can be seen in Fig. 6d. Compared to the tracking
of P control as shown in Fig. 6b, the impedance control
shows worse tracking performance.
B. MIQP+Impedance Control
Using the tuned impedance parameters from previous
section, we apply the impedance control as the feed-forward
term while using the MIQP as the feedback term to correct
the tracking errors and reject the disturbances. From Fig. 6f,
we can see the tracking with using MIQP+Impedance con-
troller is the best among the three methods in both stance
phase and non-stance phase (RMS error reduced by more
than 50% for both phases). We also tested the robustness of
the walking with MIQP+Impedance control, the robot was
able to overcome a 40mm height block and could stand for
big pushes on the prosthetic leg. The details can be seen
in the video [1]. Note that, in the video, the walking gait
using MIQP+Impedance control is not as smooth as that
with using only voltage P control. This is because of the
asymmetric control and the fact that the prosthetic joint has
better tracking than the healthy joint.
VI. CONCLUSIONS
In this work, we ﬁrst proposed a new method which is
to test and design the prosthetic controllers on a robot that
has been shown to have qualitatively human-like walking
[4]. Since the physical robot displays human-like walking
gait, which captures the essentials of human locomotion, we
claim that testing the prosthetic controller (or device) in such
1346
Fig. 7: Experimental and simulation gait tiles with only
impedance controller. Red line indicates the prosthesis.
a robot will yield qualitative information, and therefore, can
help improve the designs of both the prosthetic controller
and the lower-limb prosthetic device. Then, a novel optimal
prosthesis control algorithm: MIQP+Impedance control was
introduced to control the prosthetic device with the frame-
work discussed above. This controller beneﬁts from both the
feed-forward impedance control that gives model informa-
tion and the MIQP method that renders model independent
control in an optimal fashion that is inherited from the CLF
based QP control method. This controller has been veriﬁed
on the robot in both simulation and experiment. Compared
with the other two control methods, the proposed optimal
controller shows the best tracking performance with the same
level of energy input. The robustness tests also show that this
optimal controller can overcome disturbances and obstacles
while maintaining good tracking.
The limitations of this work are mainly due to the hard-
ware of the robot. AMBER doesn’t have feet and the ankles
are underactuated. Also, the velocity sensor data is not
usable, which limits the performance of the MIQP algorithm.
In future work, we are going to test the same algorithm on
the footed robot AMBER2 which has achieved good human-
like walking with both knee and ankle actuation [2].
REFERENCES
[1] Experimental and simulation results.
http://youtu.be/5TuTyKhMNiU.
[2] Sustainable multi-domain walking of amber2.
http://youtu.be/VvkIdCKlL54.
[3] Navid Aghasadeghi, Huihua Zhao, Levi J Hargrove, Aaron D Ames,
Eric J Perreault, and Timothy Bretl. Learning impedance controller
parameters for lower-limb prostheses. IEEE: IROS, 2013.
[4] A. D. Ames. First steps toward automatically generating bipedal
robotic walking from human data. In 8th International Workshop on
Robotic Motion and Control, RoMoCo’11, Bukowy Dworek, 2011.
[5] A. D. Ames and M. J. Powell. Towards the uniﬁcation of locomotion
and manipulation through control lyapunov functions and quadratic
programs. In Springer’s Lecture Notes in Control and Information
Science series, 2013.
[6] A.D. Ames, K. Galloway, and J.W. Grizzle. Control lyapunov
functions and hybrid zero dynamics. In Decision and Control (CDC),
2012 IEEE 51st Annual Conference on, pages 6837–6842.
[7] D.P. Atherton and S. Majhi. Limitations of pid controllers. In
American Control Conference, pages 3843–47, 1999.
Fig. 8: Experimental and simulation gait tiles using MIQP
+ Impedance control. Red line indicates the prosthesis.
[8] Christopher G Atkeson and Stefan Schaal. Robot learning from
demonstration. In ICML, volume 97, pages 12–20, 1997.
[9] Samuel Au, Max Berniker, and Hugh Herr. Powered ankle-foot
prosthesis to assist level-ground and stair-descent gaits. Neural
Networks, 21(4):654 – 666, 2008.
[10] S.K. Au, P. Bonato, and H. Herr. An emg-position controlled system
for an active ankle-foot prosthesis: an initial experimental study. In
IEEE on 9th ICORR, 2005, pages 375–9.
[11] J.A. Blaya and H. Herr. Adaptive control of a variable-impedance
ankle-foot orthosis to assist drop-foot gait. Neural Systems and
RehabilitationEngineering,IEEETransactionson, 12(1):24–31, 2004.
[12] Joseph Hitt, A Mehmet Oymagil, Thomas Sugar, Kevin Hollander,
Alex Boehler, and Jennifer Fleeger. Dynamically controlled ankle-
foot orthosis (dco) with regenerative kinetics: incrementally attaining
user portability. In IEEE International Conference on Robotics and
Automation, pages 1541–46. IEEE, 2007.
[13] Neville Hogan. Impedance control: An approach to manipulation.
pages 304–313, 1984.
[14] Y . H¨ urm¨ uzl¨ u and D. B. Marghitu. Rigid body collions of planar
kinematic chains with multiple contact points. Intl. J. of Robotics
Research, 13(1):82–92, February 1994.
[15] Ren´ e Jimenez-Fabian and Olivier Verlinden. Review of control algo-
rithms for robotic ankle systems in lower-limb orthoses, prostheses,
and exoskeletons. Medical engineering & physics, 34(4):397–408.
[16] Jun Nakanishi, Jun Morimoto, Gen Endo, Gordon Cheng, Stefan
Schaal, and Mitsuo Kawato. Learning from demonstration and
adaptation of biped locomotion. Robotics and Autonomous Systems,
47(2):79–91, 2004.
[17] Aykut Mehmet Oymagil, Joseph K Hitt, Thomas Sugar, and Jennifer
Fleeger. Control of a regenerative braking powered ankle foot orthosis.
In IEEE on 10th ICORR, 2007, pages 28–34. IEEE.
[18] Dejan Popovic, Rajko Tomovic, Dejan Tepavac, and Laszlo
Schwirtlich. Control aspects of active above-knee prosthesis. Interna-
tional Journal of Man-Machine Studies, 35(6):751 – 767, 1991.
[19] Frank Sup, Amit Bohara, and Michael Goldfarb. Design and Control
of a Powered Transfemoral Prosthesis. The International journal of
robotics research, 27(2):263–273, February 2008.
[20] Frank Sup, Huseyin Atakan Varol, and Michael Goldfarb. Upslope
walking with a powered knee and ankle prosthesis: initial results
with an amputee subject. IEEE transactions on neural systems and
rehabilitation engineering, 19(1):71–8, February 2011.
[21] Radcliffe C. W. Biomechanical basis for the design of prosthetic knee
mechanisms. Rehabilitation Engineering International Seminar, 1980.
[22] Shishir Nadubettu Yadukumar, Murali Pasupuleti, and Aaron D Ames.
From formal methods to algorithmic implementation of human in-
spired control on bipedal robots. In Algorithmic Foundations of
Robotics X, pages 511–526. Springer, 2013.
[23] H. Zhao, M. J. Powell, and A. D Ames. Human-inspired motion
primitives and transitions for bipedal robotic locomotion in diverse
terrain. In Optim. Control Appl. Meth., 2013.
1347
