Three Dimensional Trajectory Planner for Real Time Leader Following
Pedro Pereira, David Cabecinhas, Rita Cunha, Carlos Silvestre and Paulo Oliveira
Abstract—This paper presents an on-line three dimensional
trajectory planner for an unmanned vehicle following a Leader
vehicle, where the Follower remains at a speciﬁed relative
position with respect to the Leader. The planner deﬁnes the
trajectory for a virtual vehicle that will be used as reference
for the real Follower vehicle. The virtual Follower behaves like
a three dimensional trailer attached to the Leader and its
reference frame is used to specify the relative position vector.
At the kinematic level, the proposed planner requires only the
knowledge of the Leader’s linear speed, but not its angular
speed,andtheFollower’strajectory canbegeneratedon-line,in
thesensethatno a prioriknowledgeoftheLeader’strajectory is
required.Experimentalresultsobtainedwithquadrotorvehicles
are presented, which demonstrate the richness of the planned
trajectories.
I. INTRODUCTION
Multi-robot systems are an active research topic as they
allow improved performance on accomplishing automated
tasks. Multi-robot systems outperform single robot systems
in situations where a wide area needs to be covered like
terrainmappingor explorationofaseaﬂoor[1],[2].Another
use case is load transportation where a formation of vehicles
can handle loads that would be otherwise impossible for a
single vehicle to transport [3]. Multiple vehicle formations
are also employed in critical missions, where the objective
is of paramount importance and robustness to vehicle loss is
required [4].
In the Leader-Follower approach to formation control, the
objective is for a Follower vehicle to remain at a ﬁxed
relativeposition, in a given referenceframe,w.r.t. the Leader
vehicle. The problem is completely characterized by the
relative position vector and the reference frame where it is
deﬁned. The choice of reference frame plays an important
role in the deﬁnition of the Follower’s trajectory and in the
sensory informationnecessary for computingsuch trajectory.
AstraightforwardapproachtotheLeader-Followerformation
deﬁnition is to specify the relative position vector in the
inertial reference frame as in [5], [6]. This method results
in a simple trajectory for the Follower, in the sense that
both the Leader and the Follower describe an identical path,
This work was supported byproject FCT PEst-OE/EEI/LA0009/2013 and
by project FCT SCARVE (PTDC/EEA-CRO/102857/2008).
The work of P. Pereira was supported by a Research Student Grant under
the FCT project PEst-OE/EEI/LA0009/2011.
The authors are with the Department of Electrical Engineering and
Computer Science, and Institute for Robotics and Systems in Engi-
neering and Science (LARSyS), Instituto Superior Técnico, Universi-
dade Técnica de Lisboa, 1049-001 Lisboa, Portugal. D. Cabecinhas
and C. Silvestre are also with the Department of Electrical and Com-
puter Engineering, Faculty of Science and Technology of the University
of Macau. {ppereira,dcabecinha}@isr.ist.utl.pt and
{rita,cjs,pjcro}@isr.ist.utl.pt
apart from a translation. This is inconvenient for mapping
or terrain covering purposes because the Follower’s path can
overlap with the Leader’s path, reducing the efﬁciency gains
of using multiple aircraft.
Deﬁning the relative position vector in a reference frame
rotating with the Leader, such as the Leader’s Serret-Frenet
frame, results in Follower trajectories with more complex
behavior. This approach has been proposed by several au-
thors [7], [8], [9] but requires, at the kinematic level, the
explicit knowledge of parameters that are not easily mea-
sured or estimated by the Follower, such as the Leader’s
reference frame angular velocity. Additionally, the works
deal with a two dimensional setting and an extension for
a three dimensional environment is not trivial, as it can
lead to discontinuities or trajectories that are ill-deﬁned as a
consequence of choosing a Serret-Frenet reference frame.
A two part solution to the Leader-Follower formation
problem in here proposed. First, a desired trajectory is
computed for an ideal Follower vehicle, hereafter called
virtual Follower. This reference trajectory is then used as
a reference to a trajectory tracking controller that drives the
real Follower vehicle to the desired trajectory. In this paper,
we focus on the ﬁrst problem of generating the follower
trajectory and present experimental results for the complete
planning/tracking problem using quadrotor vehicles. A new
trajectory generation strategy is proposed to address the
Leader-Follower problem where the relative position vector
is speciﬁed in a reference frame attached to the virtual
Follower, which is always well-deﬁned. By imposing the
appropriatekinematic constraints on the reference frame, the
virtual Follower is made to behave as a three dimensional
trailer attached to the Leader.Thetrajectoryplannerdoesnot
require,atthe kinematiclevel,theknowledgeof theLeader’s
path curvature and torsion but it still produces trajectories
with a rich behavior that are not a simple translation of the
Leader’s path.
Quadrotors are aerial vehicles ideal for testing algorithms,
due to their simplicity, high maneuverability, VTOL/hover
capability and ability to track any trajectory within the
limits of their actuation dynamics. Tracking controllers for
quadrotor vehicles have been extensively studied in the
literature,c.f.thesurveyarticle[10],andthe virtualFollower
trajectory generated by our planner can be used as reference
for any generic tracking controller applied to the Follower
vehicle.
The remainder of this paper is structured as follows. Sec-
tion II presents the mathematical notation used throughout
thepaper.SectionIIIdescribestheLeader-Followerproblem.
Section IV describes the trajectory planner equations and
2014 IEEE International Conference on Robotics & Automation (ICRA)
Hong Kong Convention and Exhibition Center
May 31 - June 7, 2014. Hong Kong, China
978-1-4799-3684-7/14/$31.00 ©2014 IEEE 6561
provesthe convergenceof a Leader-Followerformation for a
Leader describing a trimming trajectory. Section V describes
the experimental set-up for the quadrotor vehicles and Sec-
tion VI presents the obtained experimental results.
II. NOTATION
The conﬁguration of a reference frame{B} w.r.t. a frame
{A} is represented as an element of the Special Euclidean
group, (
A
B
R,
A
p
B
) ? SE(3), where
A
p
B
? R
3
is the
position and
A
B
R? SO(3) is the rotation matrix. For points
in the inertial frame {I}, the upper script frame letter is
often omitted, i.e. p
B
:=
I
p
B
. The following functions and
symbols are used throughout this paper. The sign function
sgn(x) :R7?R satisﬁes sgn(0) = 0 and sgn(x) = x|x|
?1
for x 6= 0. The map S(x) : R
3
7? R
3?3
yields a cross-
product skew-symmetric matrix such that S(a)b = a? b.
The map ?(x) : {x ? R
3
: x
T
x = 1} 7? R
3?3
where
?(x) =?S(x)
2
yields a matrix that represents the orthog-
onal projection operator onto the subspace perpendicular to
x. The vectors e
i
? R
3
with i = {1,2,3} are used to
denote the unit vectors from the canonical basis forR
3
. We
write as f
(i)
(t) the i
th
time derivative of function f(t) for
i ={1,2,...}.
III. PROBLEM STATEMENT
In a Leader-Follower problem, the primary objective is to
keep the Leader and Follower vehicles separated by a ﬁxed
distance and a ﬁxed direction speciﬁed in a given reference
frame.We proposeatwostep approachto theproblemwhich
separates the problem of trajectory planning from that of
trajectory tracking.
This paper focuses on the ﬁrst step of generating the
referencetrajectory.Theproblemisaddressedbyconsidering
a virtualvehiclethatmeetsthe primary objectiveatalltimes.
The planner’s output is then fed as a reference trajectory
to the trajectory tracking controller implemented in the real
Follower vehicle.
To describe the problem setup consider the inertial refer-
ence frame {I}, the Leader’s Frenet reference frame {L}
deﬁned by the pair (
I
L
R,p
L
) ? SE(3) and the virtual
Followerreferenceframe{F}deﬁnedas(
I
F
R,p
F
)?SE(3).
The kinematics of
I
L
R are given by
I
L
˙
R =
I
L
RS(?
L
),
with ?
L
as the Leader’s angular velocity, given by ?
L
=
kv
L
k

?
L
0 ?
L

T
, and v
L
, ?
L
and ?
L
as the Leader’s
velocity, path curvature and path torsion, respectively.
In a Leader following strategy, the distance between
Leader and virtual Follower is ﬁxed and the relative position
between them is given by the vector d = [d
x
d
y
d
z
]
T
?R
3
speciﬁed in the virtual Follower frame{F}, i.e.
p
L|F
? p
L
?p
F
=
I
F
Rd, (1)
and the primary goal is to deﬁne the time evolution of
I
F
R.
IV. TRAJECTORY PLANNER
To completely deﬁne the virtual Follower’s trajectory,
we act on the the kinematics of
I
F
R which are given by
I
F
˙
R =
I
F
RS(?
F
), where ?
F
:= [p
F
q
F
r
F
]
T
?R
3
is the
angular velocity of the frame{F}. The choice of ?
F
has a
signiﬁcant impact on the planned trajectory. For example, if
we trivially set ?
F
= 0 then the virtual Follower path would
simply be a translation of the Leader’s path. If we impose
appropriate constraints on the angular velocity of the virtual
Follower we can generate richer trajectories, e.g. by forcing
the Follower vehicle to behave as a 3D trailer attached to the
Leader.We nowderivetheconditionson theangularvelocity
?
F
and show that
L
p
L|F
converges to a ﬁxed vector, under
some given assumptions.
A. Trajectory Planner for a Longitudinal Rigid Link
x
{I}
y
{I}
z
{I}
x
{F}
y
{F}
z
{F}
p
F
p
L
d
x
x
{L}
y
{L}
z
{L}
Fig. 1: Leader-Follower separated by a length d
x
along the
longitudinal axis of the virtual Follower reference frame
Consider a virtual Follower as a 3D trailer attached to a
Leaderbyalongitudinalrigidlinkoflengthd
x
,aspicturedin
Figure 2, so that d = d
x
e
1
. Let the 3D trailer body velocity
be u := [u v w]
T
so that ˙ p
F
:=
I
F
Ru. Taking the time
derivative of (1) it follows
I
F
R

I S(?e
1
)


u
?
F
d
x

= v
L
. (2)
In a three dimensional setting, a trailer is a vehicle that can
only move longitudinally, i.e. u =ue
1
, and it is allowed to
yaw and pitch freely. Due to the nature of the longitudinal
link, the roll rate p
F
does not play any role in deﬁning the
position of the Follower and can be interpreted as a degree
of freedom. Applying these restrictions to (2) it follows
u =e
T
1
u = v
T
L
I
F
Re
1
, (3)
?
F
= d
?1
x
S(e
1
)
F
I
Rv
L
+p
F
e
1
. (4)
For p
F
(t) = 0, the reference frame (
I
F
R,p
F
) is a parallel
transport frame [11]. Notice that the trajectory generation is
completely deﬁned by (4), which only requires the knowl-
edge of the Leader’s linear speed and
I
F
R (which is always
well deﬁned). The variables deﬁned in what follows are only
used for the purposes of analysis. We write the Leader’s
velocity as v
L
= kv
L
k
I
L
Re
1
and introduce the shorthand
notation
R :=

r
1
r
2
r
3

:=
L
F
R.
For a longitudinal link connecting the two vehicles, the
Leader-Followerformation is deﬁned by the relativeposition
vector
L
p
L|F
= r
1
d
x
and, consequently, a rigid formation is
obtained if r
1
converges to a ﬁxed vector. Rotations around
r
1
areallowedastheydonotbreaktherigidformation.From
(3), if the Leader is at rest so is the virtual Follower; in
that case, the formation stays ﬁxed w.r.t.{I}. Hereafter, this
trivial situation is ignored by assumingkv
L
(t)k≥v
min
L
> 0
6562
for all t.
1) Stability analysis of the three dimensional trailer for-
mation for trimming trajectories : Consider a Leadervehicle
describing a trimming trajectory characterized by constant
torsion ?
L
and curvature ?
L
, i.e. a helix trajectory. The
kinematics of the rotation matrix R are given by
˙
R =S(R?
F
??
L
)R. (5)
From the kinematics (5), it can be shown that r
1
is a ﬁxed
vector if and only if the error z given by
z(r
1
) = ?(r
1
)

R?
F
kv
L
k
?
?
L
kv
L
k

(6)
is zero. Notice that the error is deﬁned to be velocity-
independent, that is, it depends only on the characteristics
of the Leader’s path and not on the velocity with which it
is described by the vehicle. Solving z(r
?
1
) = 0 and denoting
the solution by its components r
?
1
= [r
?
11
r
?
12
r
?
13
]
T
we get
r
?
11
=±
v
u
u
t˜ r
2
11
2
+
s
d
2
x
?
2
L
+

˜ r
2
11
2
2
, (7)
r
?
12
=?
1?r
?2
11
?
L
d
x
,
r
?
13
=
1?r
?2
11
r
?
11
?
L
?
L
, (8)
where ˜ r
2
11
= 1?d
2
x
(?
2
L
+?
2
L
) and the additional relation

?
L
0 ?
L

r
?
1
=?
L
r
??1
11
. (9)
It can be shown the derivative of r
?2
11
with respect to the
variable ? = (?
L
d
x
)
2
is always positive, which means that
for a path with curvature ?
L
we have
lim
?L?0
r
?2
11
≤ r
?2
11
≤ lim
?L?∞
r
?2
11
? 1?(d
x
?
L
)
2
≤ r
?2
11
≤ 1. (10)
Equation (10) guarantees that (7)-(8) are well-deﬁned and
provide two solutions for z(r
?
1
) = 0 when (d
x
?
L
)
2
< 1.
We now introduce Lemma 1 to help determine which of the
two solutions coming from (7)-(8) is attained by the Leader-
Follower formation, i.e. to which solution r
1
converges to.
Lemma 1: Consider a Leader vehicle describing a path
with non-zero velocity v
L
(t) ? C
1
(R
3
) and with curvature
?
L
(t) ? C
1
and a virtual Follower vehicle imbued with
kinematics (4). If the initial conditions for matrixR =
L
F
R
verify r
11
(0) sgn(d
x
)≥ 0 and if the Leader’s path curvature
is bounded such that |?
L
(t)d
x
|
∞
< 1, then it follows that
r
11
(t) sgn(d
x
)> 0 for all t> 0.
Proof: Computing the time derivative of r
11
yields
˙ r
11
=kv
L
kd
?1
x
 
1?r
2
11
+(?
L
d
x
)r
12

. (11)
The function r
11
(t) :=
v
T
L
kvLk
I
F
Re
1
is continuous in time
andconsequentlyitcannotbecomenegativewithoutcrossing
r
11
= 0.However,forr
11
= 0and|?
L
(t)d
x
|
∞
< 1,itfollows
from (11) that ˙ r
11
sgn(d
x
) > 0 and r
11
(t) sgn(d
x
) will
increase and become positive. Then, if the initial condition
r
11
(0) sgn(d
x
) is positive or zero, it will remain positive for
all subsequent time.
We are now able to state the following Theorem, aggre-
gating the results for the proposed Follower path generation
and convergence of the Leader-Follower system to a rigid
formation.
Theorem 2: Consider a Leader vehicle with non-zero ve-
locity v
L
(t)?C
1
(R
3
) describing a trimming trajectory path
with constant curvature ?
L
and torsion ?
L
and a virtual
Followerimbued with kinematics(4). If theinitial conditions
for matrix R =
L
F
R verify r
11
(0) sgn(d
x
) ≥ 0 and if the
Leader’s path curvature is bounded such that |?
L
d
x
| < 1,
then the Leader and Follower vehicles converge to a rigid
formation with relative position vector given by
L
p
?
L|F
= r
?
1
d
x
,
with r
?
1
coming from the solution (7)-(8) that renders
r
?
11
sgn(d
x
)> 0.
Proof: Consider the Lyapunov function V(z) =
1
2
z
T
z
with the error z deﬁned as in (6). The time derivative of the
error can be computed with the help of (5), yielding
˙ z =?kv
L
kd
?1
x
r
11
z+
˙
?(r
1
)

R?
F
kv
L
k
?
?
L
kv
L
k

. (12)
From (12), and noticing that
˙
?(r
1
)z = 0, it follows that the
time derivative of the Lyapunov function is
˙
V(t,z) =?r
11
(t)d
?1
x
kv
L
kz
T
z. (13)
FromLemma1,andfortheconditionsstatedintheTheorem,
it follows trivially that the time derivative (13) is negative
deﬁnite. The system dynamics for the error z has an expo-
nentially stable point at the origin, resulting in convergence
of r
1
to the solution (7)-(8) with positive r
?
11
sgn(d
x
).
From (13) it is clear that the solution in (7) satisfying
r
11
sgn(d
x
)> 0 is stable and the one satisfying r
11
sgn(d
x
)<
0 is unstable.To gain some insightinto the physicalinterpre-
tation of this result, notice that the solution r
11
sgn(d
x
)> 0
corresponds to a trailer being pulled (which is a stable
operation) and the solution r
11
sgn(d
x
) < 0 corresponds to
a trailer being pushed (which is an unstable operation).
An interesting characteristic of the virtual Follower’s
equilibrium path is that it is also a curve of constant torsion,
?
F
and curvature?
F
, with ?
F
=
?L
r
?2
11
and ?
F
=
√
1?r
?2
11
|dx|r
?
11
.
B. Trajectory Planner for a Generic Rigid Link
We now consider a Leader-Follower formation with a
generic relative position vector d ? R
3
where d
y
and d
z
are no longer constrained to be zero. In order for the path
generation method to be an extension of the one described
in Section IV-A we maintain the virtual Follower kinematics
as deﬁned in (4). Like with the longitudinal link situation,
the choice of roll rate plays no role in the convergence of
r
1
and the reasoning in Theorem 2 is applicable, which
guarantees convergence of r
1
to r
?
1
remains valid. Unlike
the previous situation, however, the roll rate does inﬂuence
the generated path since we now have the components d
y
and d
z
that interact with r
2
and r
3
to generate the virtual
6563
Follower’s position.
For the purposes of studying the generated Follower path
when the Leader is performing a trimming trajectory, the
convergence of r
2
and r
3
is analyzed through the introduc-
tion of a new error
z
2
=
p
kv
L
k
?
?
T
L
kv
L
k
r
1
, (14)
relating the angular velocities of the Leader and Follower
along the direction r
1
. Keeping in mind that the Leader-
Follower formation is deﬁned by the relative position vector
L
p
L|F
=Rd, a rigid formation is attained when the rotation
matrix is constant. Given the rotation matrix kinematics (5)
and convergence of the error (6) to zero, a rigid formation
with a generic relative position vector is attained if and only
if the error z
2
is zero.
n
I
L
Re
1
I
L
Re
1
?
d
I
F
Re
1
I
F
Re
1
R
?
1
R
?
2
R
?
2
R
?
1
dx
dy
dy
?
?1
L
{
I
L
R,pL}={L} : Leader Frenet frame
{
I
F
R,pF}={F} : Longitudinal link
{
I
F
R,pF}={F} : Generic link
?
d
=?arcsin(?Ldx)
L
I
R
I
F
R
?
1
?R
?
1
=Rz(?
d
)
L
I
R
I
F
R
?
2
?R
?
2
=Rz(?
d
)Rx(π)
Fig. 2: Possible
L
F
R conﬁgurations for d
x
,d
y
> 0
Similarly to what occurs for the error z, there are two
solutions that satisfy z
2
= 0. To have a better understanding
of what the solutions correspond to, consider a Leader
describing a circular path and d = [d
x
d
y
0] with d
x
> 0
and d
y
> 0, as shown in Figure 2. In the ﬁgure, two Leaders
are shown describing a path in clockwise and anti-clockwise
directions. The notion of clockwise and anti-clockwise is
arbitrary and it is deﬁned in this work as follows: consider
the unit vector n, then if the Leader’s angular velocity
is aligned with n, i.e. n
T I
L
R?
L
> 0, the rotation is
clockwise; if those are misaligned, i.e. n
T I
L
R?
L
< 0, the
rotation is anti-clockwise (an ambiguous situation exists if
n
T I
L
R?
L
= 0). For each of these situations, the Follower
can meet the rigid formation speciﬁcation d in two different
ways, correspondingto the two solutionsR
?
forz
2
(R
?
) = 0
as follows
R
?
1
=R
z
(?
d
) ? R
?
2
=R
z
(?
d
)R
x
(π) (15)
withwhere?
d
issuchthat sin(?
d
) =??
L
d
x
andR
x
andR
z
denote rotation matrices about thex andz axis, respectively.
We propose a trajectory planner that imbues the Follower
vehicle with the following behavior. If the Leader’s rota-
tion is clockwise the Follower moves in an outer circle,
corresponding to R
?
1
in (15). On the other hand, if the
Leader’s rotation is anti-clockwise the Follower moves in an
inner circle, corresponding to the solution R
?
2
in (15). This
behavior is proposed because the Leader’s third axes
I
L
Re
3
inverts direction from clockwise to anti-clockwise paths but
it is desirable that the virtual Follower’s third axes
I
F
Re
3
remains aligned with n, mimicking the behavior of a 2D
trailer with d
y
6= 0 [12]. For a Leader vehicle describing
a planar path, the Follower is also required to describe a
planar path in a plane parallel to that of the Leader, leading
to (
I
L
Re
3
)
T I
F
Re
3
= ±1. In that situation, the planes of
motion where the vehicles evolveare separated by a distance
d
z
, speciﬁed along the direction
I
F
Re
3
, and the condition
v
T
L
I
F
Re
3
= 0is met.Inordertoremaininaplanarpath,the
Followervehiclecannotrollnor pitch.From(4) we havethat
q? v
T
L
I
F
Re
3
and consequently,for the Follower to remain
in a planar path the roll rate must satisfy p ? v
T
L
I
F
Re
3
.
With the previous comments in mind, the following roll rate
is selected
p = s
?
(t)v
T
L
I
F
Re
3
|d
?1
y
| (16)
= s
?
(t)r
31
kv
L
k|d
?1
y
|
where s
?
(t) ? C
2
is an altered signum function that is
obtained by solving the differential equation
s
?(3)
+a
2
s
?(2)
+a
1
s
?(1)
+a
0
s
?
=a
0
·? (17)
where ? = sgn(n
T I
F
Re
3
)sgn(v
T
L
I
F
Re
2
) and a
0
, a
1
, and
a
2
are such that {a
2
> 0,a
2
a
1
> a
0
}. The conditions
on the coefﬁcients of (17) ensure that s
?
(t) converges
asymptotically to the current value of ?, which takes values
in{?1,0,1} and is allowed to change during the maneuver.
The value of? is deﬁned to ensure that the stable solution to
z
2
(R
?
) = 0 follows the behavior speciﬁed in the preceding
paragraph and thus mimics the motion of a 2D trailer for the
case of planar trajectories. The function s
?
(t)? C
2
is used
instead of the discontinuous function ? so as to provide a
smooth enough reference position to the trajectory tracking
controller. With the roll rate deﬁned as in (16), the error z
2
in (14) can be rewritten as
z
2
= s
?
(t)r
31
|d
?1
y
|?

?
L
0 ?
L

r
1
.
Considering the equilibrium where (9) is satisﬁed and
s
?
(t) =?, a solution R
?
can be computed for z
2
(R
?
) = 0.
We provide the result for r
?
33
only,
r
?
33
= sgn(r
?
21
)
??
2
L
|d
y
||d
x
|+
p
r
?2
11
(1?r
?2
11
)?(?
L
d
y
)
2
?
L
|d
x
|r
?
11
, (18)
whichis uniquelydeﬁnedfor?
L
6= 0andexistsprovidedthat
d
y
is upper bounded by an expression, which is omitted due
to space limitations. Qualitatively, an upper bound on |d
x
|
and |d
y
| exist because beyond those bounds, the condition
R?
F
??
L
= 0 cannot be met, in which case an equilibrium
does not exist. (However, for planar paths d
y
can take any
valuebecausep
F
= 0regardlessofd
y
).If?
L
= 0,theLeader
describes a rectilinear trajectory and there are no preferred
directions forr
?
2
and r
?
3
, leading to an inﬁnitude of solutions
6564
for R
?
(all solutions R
?
= R
x
(?), for all ? ? R, satisfy
z
2
(R
?
) = 0).
To check the stability of the solutions consider the Lya-
punov function V
2
(z
2
) =
1
2
z
2
2
. The time derivative of the
error z
2
is given by
˙ z
2
(t,z
2
) =??r
21
kv
L
k|d
?1
y
|z
2
+g(t)+h(t), (19)
with g(t) = ?
T
z
z and h(t) = ?
T
s
?

s
?
?? s
?(1)
s
?(2)

and
where ?
z
and ?
s
? are bounded. Then, under the conditions
of Theorem 2 the term g(t) converges exponentially fast to
0. Additionally, ? is constant if we are sufﬁciently close to
the stable equilibrium, implying that h(t), which aggregates
the errors due to usings
?
(t) instead of?, also convergesex-
ponentially fast to 0. The Lyapunov function time derivative
yields
˙
V
2
=??r
21
kv
L
k|d
?1
y
|z
2
2
+z
2
(g(t)+h(t))
=?sgn(n
T I
F
Re
3
)|r
21
|kv
L
k|d
?1
y
|z
2
2
+z
2
(g(t)+h(t)),
meaning that the system (19) is locally input-to-state sta-
ble (ISS), with g(t) + h(t) as input, if and only if
sgn(n
T I
F
Re
3
) > 0 (notice that, for ?
L
6= 0 and ?
L
= 0
we have r
?
21
6= 0). The ISS property guarantees that in
a given domain, if g(t) + h(t) converges to zero, then
z
2
will also converge to zero. Notice that the solution for
which the virtual Follower third axis is aligned with n, i.e.
sgn(n
T I
F
Re
3
) > 0, is stable, whereas the other solution
with sgn(n
T I
F
Re
3
)< 0 is unstable.
C. Trajectory Planner Summary
The proposed trajectory planner is a dynamic one, in the
sense that it computesthe virtual Follower’s trajectory based
on (1). The virtual Follower rotation matrix
I
F
R can be
interpreted as the state of the planner and whose kinematics
are ruled by (4) and (16).
For the initialization, two options are available. If the
Leader is initially at rest then the desired Follower position
should be that which is closest to the real Follower. If the
Leader is initially moving then the best guess is that it
is moving straight, in which case the virtual Follower is
initializedtomatchtheequilibriumsolution,i.e.
I
F
R(0)e
1
=
vL(0)
kvL(0)k
sgn(d
x
).
V. EXPERIMENTAL SET-UP
The proposed trajectory planner was tested with two
radio controlled Blade mQX quadrotor vehicles [13]. A
VICON Bonita motion capture system [14], composed of
12 cameras and markers attached to the quadrotors,provides
highly accurate position and orientation measurements for
the Leader and Follower at a rate of 100Hz. The trajectory
planner is implemented in a Matlab/Simulink model, which
computestheFollower’spositionreferenceandfeedsitto the
quadrotors’ trajectory tracker controller developed in [15]
which requires a time-parametrized position reference of
class C
3
. Consequently, the trajectory planner requires the
knowledge of p
(i)
L
(t) for i ? {1,2,3}, which are obtained
?1
0
1
2
?1
0
1
?2
?1
0
1
x Axis (m)
y Axis (m)
z Axis (m)
(a) Vehicle’s trajectories
0 10 20 30 40
?200
?150
?100
?50
0
50
100
150
200
Time (s)
Degrees (
?
)
?
?
?
?
?
?
?
?
?
(b) Euler Angles forR and forR
?
Fig. 3: Leader describing lemniscate path
?1.5
?1
?0.5
0
0.5
1
1.5
?1
0
1
?1.5
?1
?0.5
x Axis (m)
y Axis (m)
z Axis (m)
(a) Vehicle’s trajectories
0 10 20 30 40 50
?0.5
0
0.5
1
1.5
2
2.5
Time (s)
Length (m)
epx(m)
epy(m)
epz(m)
kekp
(b) Tracking position error between
virtual and real Follower
Fig. 4: Circular path with sinusoidal altitude variation
from the raw position measurements by means of dynamic
differentiators.
VI. EXPERIMENTS
Three experiments are presented, where the Leader’s path
is depicted in red, the real Follower’s path in blue and
the virtual Follower’s path in magenta, with the magenta
referenceframebeingthatofthevirtualFollower,i.e.
I
F
R.In
Figures 5(a), 5(b), 5(c), 3(a) and 4(a) the vehicles’ positions
are shown ﬁve times, with ? symbol for the initial position
and symbol for the other positions, equally spaced in
time (elapsed time divided by four). In all experiments, the
Leader’s velocity was set at 0.5m/s and n was set to ?e
3
.
The position tracking error between the virtual Follower and
therealFollowerisonlypresentedforoneoftheexperiments
in Figure 4(b).
Considerthexyz Euleranglesforattitudeparametrization,
deﬁned such that R := R
z
(?)R
y
(?)R
x
(?) and R
?
:=
R
z
(?
?
)R
y
(?
?
)R
x
(?
?
). We have shown that if the Leader
describes a trimming path, i.e. a helix, the relative position
between Leader and Follower converges to
L
p
?
F|L
= R
?
d,
whereR
?
:=R
?
(?
L
,?
L
), with constant?
L
and?
L
. For non
trimmingpaths,thematrixRisexpectedto followthematrix
R
?
:= R
?
(?
L
(t),?
L
(t)) where ?
L
(t) and ?
L
(t) are time-
varying. The Euler angles {?,?,?} and {?
?
,?
?
,?
?
} are
presented in dashed and full lines, respectively in Figures
5(d) and 3(b), with {?
?
,?
?
,?
?
} computed from (7)-(8) and
(18) and {?,?,?} computed fromR :=
L
I
R
I
F
R.
Figures 5(a)-5(c) depict the paths for d = [0.4 ?
0.4 0]
T
(m) and with the Leader quadrotor describing a path
composed of two circular paths: one in a horizontal plane
and the other in a plane tilted 45
?
, meaning that ?
L
= 0 for
most of the path, except during transition between planes.
Notice the convergence of the virtual Follower’s path to
6565
?1
?0.5
0
0.5
1
?1
?0.5
0
0.5
1
?1.5
?1
?0.5
0
y Axis (m)
x Axis (m)
z Axis (m)
(a) Trajectories from 0s to 11s
?1
?0.5
0
0.5
1
?1
?0.5
0
0.5
1
?1.5
?1
?0.5
0
y Axis (m)
x Axis (m)
z Axis (m) (b) Trajectories from 11s to 35s
?1
?0.5
0
0.5
1
?1
?0.5
0
0.5
1
?1.5
?1
?0.5
0
y Axis (m)
x Axis (m)
z Axis (m)
(c) Trajectories from 35s to 61s
0 10 20 30 40 50 60
?50
0
50
100
150
200
Time (s)
Degrees (
?
)
?
?
?
?
?
?
?
?
?
(d) Euler Angles forR and forR
?
Fig. 5: Leader describing circular paths in planes tilted 0
?
and 45
?
a zero-torsion path in the Leader’s plane, which follows
from d
z
= 0. Except during the transition between planes,
the Leader describes trimming paths and for that reason
{?,?,?} converge to {?
?
,?
?
,?
?
} which are constant (see
Figure5(d)).The virtualFollower’sthirdaxis
I
F
Re
3
remains
aligned with n, i.e. sgn(n
T I
F
Re
3
)> 0 (?
?
= 180
?
because
sgn(n
T I
L
Re
3
)< 0).
In Figure 3(a), d = [0.35 0.35 ?0.3]
T
(m) and the Leader
quadrotor describes a lemniscate path in a horizontal plane,
deﬁned as
p(?) = 1.7R
z

?
π
4
h
cos(?)
1+sin
2
(?)
1
2
sin(2?)
1+sin
2
(?)
?1.1
i
T
(m)
with ˙ ? =
0.5
1.7
q
1+sin
2
(?). Again, ?
L
= 0 and the virtual
Follower converges to a plane parallel to the Leader’s plane,
without any prior knowledge that the Leader is moving
in that plane. The Leader’s path is not a trimming one,
consequently{?
?
,?
?
,?
?
}, presented in Figure 3(b), vary in
time. Notice that ? follows ?
?
with a certain delay; ? and
?
?
are zero because the trajectory is planar; and ? and ?
?
switch between 0
?
and 180
?
for clockwiseand anticlockwise
rotations, respectively. Because
I
F
Re
3
is aligned with n, the
Follower’s curvature is smaller when the Leader’s rotation
is clockwise and larger when the Leader’s rotation is anti-
clockwise.
Finally, in Figure 4(a), d = [0.4 0.4 0]
T
(m) and a Leader
quadrotor describes a circular path with a sinusoidal altitude
variation. The Leader’s path is not planar but the virtual
Follower, which behaves like a 3D trailer attached to the
Leader, is at each moment compelled to remain in the oscu-
latingplaneoftheLeader(spannedby
I
L
Re
1
and
I
L
Re
2
).As
shown in Figure 4(b), the tracking error converges to zero,
which is equivalent to the convergence of the magenta and
blues lines.
VII. CONCLUSION
In this paper, a real-time three dimensional trajectory
planner for Leader following is presented. The proposed
solution maintains a ﬁxed relative position vector between
Leader and Follower, written in a virtual Follower reference
frame, and it does not require a priori knowledge of the
Leader’s path. For a longitudinal relative position vector,
the virtual Follower reference frame is that of a three
dimensional trailer attached to the Leader. Convergence of
the formation for a Leader describing a trimming trajectory
was shown, considering both a longitudinal and a generic
relative positive vector. Experimentsperformed with quadro-
tor vehicles were conducted that demonstrate the richness
and suitability of the generated trajectories. Directions for
future work include studying a sequence of n-trailers and
incorporating a collision avoidance strategy.
REFERENCES
[1] H. Yamaguchi. A distributed motion coordination strategy for multiple
nonholonomic mobile robots in cooperative hunting operations. In
Proceedings of the 41st IEEE Conference on Decision and Control,
volume 3, pages 2984–2991 vol.3, 2002.
[2] James G.Bellingham andKannaRajan. Robotics inremote andhostile
environments. Science, 318(5853):1098–1102, 2007.
[3] J. Fink, N. Michael, S. Kim, and V. Kumar. Planning and control for
cooperative manipulation and transportation with aerial robots. The
International Journal of Robotics Research, 30(3), March 2011.
[4] T.H. Summers, Changbin Yu, and B. D O Anderson. Robustness to
agent loss in vehicle formations and sensor networks. In 47th IEEE
Conference on Decision and Control, pages 1193–1199, 2008.
[5] G. Wen, Z. Peng, Y. Yu, and A. Rahmani. Planning and control of
three-dimensional multi-agent formations. IMA Journal of Mathemat-
ical Control and Information, 2012.
[6] S. Mastellone, D. M. Stipanovic, C. Graunke, K. Intlekofer, and
M. Spong. Formation control and collision avoidance for multi-agent
non-holonomic systems: Theory and experiments. I. J. Robotic Res.,
27(1):107–126, 2008.
[7] R. Cui, S. Sam Ge, B. How, and Y. Choo. Leader follower formation
control of underactuated autonomous underwater vehicles. Ocean
Engineering, Volume 37:1491–1502, December 2010.
[8] Zhaoxia Peng, Guoguang Wen, Ahmed Rahmani, and Yongguang Yu.
Leader–follower formation control of nonholonomic mobile robots
based on a bioinspired neurodynamic based approach. Robotics and
Autonomous Systems, June 2013.
[9] G.L. Mariottini, F. Morbidi, D. Prattichizzo, G.J. Pappas, and K. Dani-
ilidis. Leader-follower formations: Uncalibrated vision-based localiza-
tion and control. In 2007 IEEE International Conference on Robotics
and Automation, pages 2403–2408, 2007.
[10] Minh-Duc Hua, T. Hamel, P. Morin, and C. Samson. Introduction to
feedback control of underactuated VTOL vehicles: A review of basic
control design ideas and principles. Control Systems, IEEE, 33(1):61–
75, 2013.
[11] Andrew J. Hanson and Hui Ma. Parallel transport approach to curve
framing. Technical report, 1995.
[12] V. Roldão, R. Cunha, D. Cabecinhas, P. Oliveira, and C. Silvestre. A
novel leader-following strategy applied to formations of quadrotors.
In European Control Conference (ECC), 2013.
[13] "Quadrotor speciﬁcations". http://www.bladehelis.com, September
2013.
[14] "Vicon system". http://www.vicon.com, September 2013.
[15] D. Cabecinhas, R. Cunha, and C. Silvestre. Saturated output feedback
control of a quadrotor aircraft. In American Control Conference
(ACC), pages 4667–4602, 2012.
6566
