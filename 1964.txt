  
? 
Abstract— Flexible endoscope has been used for the diagnosis 
of the large intestine. This paper aims at the development of 
navigation software that provides the surgeon with the 2D/3D 
shape of flexible endoscope inside the colon real time. It helps 
surgeon insert the endoscope in a safe manner and locate the 
position of the lesion. With the information of the insertion 
length and the position/orientation information of the distal end, 
we propose a shape prediction algorithm with consideration of 
constrained geometry and gravity load of the flexible endoscope. 
To corroborate the effectiveness of the shape prediction 
algorithm, we perform simulation using 2D/3D flexible 
endoscope models and verify the result through experiments. 
 
I. INTRODUCTION 
 
Medical care can be classified as diagnosis and therapy. In 
the medical therapy, surgical robots have drawn much 
attention. Successful commercialized products are being used 
in clinics. In the medical diagnosis, many devices such as MRI, 
CT and ultrasonic device are indispensable in hospitals. 
Moreover, a variety of navigation software based on patient 
data obtained from those diagnosis devices are being used in 
clinics. These days, efforts to combine the diagnosis tools and 
surgical robots are being pursued all over the world. 
However, currently existing navigation software still 
needs to enhance reliability and operational accuracy for 
extensive usage in clinics. High performance navigation 
software would minimize the usage of diagnosis device in the 
intra-operative procedure. As a result, exposure to radiation 
and operation time could be reduced.  
Advent of the endoscope has changed the paradigm of 
surgery greatly. Even narrow spaces inside the human body 
could be visualized using the endoscope. Specially, flexible 
endoscope is a good means to diagnosis the internal states of 
the stomach or the colon. However, just looking at the camera 
image, it is hard for surgeon to recognize the direction and 
location of the distal end of the flexible endoscope inside the 
colon. Though continual usage of X-ray may help recognize 
the current states, it is not recommended because of too much 
radiation exposure and inconvenience of installing the C-arm 
during diagnosis.  
Continuum type robot manipulators have drawn much 
attention these days. Different from industrial robot 
manipulators being used in automation fields, continuum type 
robot systems are useful for applications such as exploration 
of curved environment like pipelines or sinus of the human 
body. Biomimetic robotic systems mimicking the legs of 
mollusks such as a continuum-like octopus have been also a 
 
Jiun Jeon is with the Electronic Systems Engineering Department, 
Hanyang University, Ansan, Korea (e-mail:jiun@hanyang.ac.kr). 
B.- J. Yi is with the Electronic Systems Engineering Department, 
Hanyang University, Ansan, Korea (corresponding author, e-mail: 
bj@hanyang.ac.kr). 
rising research field. Quite a few research works on kinematic 
modeling of continuum kinematic chains have been reported 
[1-4]. Applications of continuum kinematic chain also have 
been very diverse [5-6]. The transmission line of the 
colonoscope is also a kind of continuum. It is a continuous 
system, so it is usually hard to predict the behavior in the free 
space. Such a continuum kinematic chain can be modeled as a 
kinematically redundant robot manipulator which has more 
joint inputs compared to the number of output [7-8]. Other 
researchers modeled the continuum as an elastic kinematic 
chain [9-11] .  
Shah, et al [12-13] investigated the shape prediction 
algorithm for colonoscope. They reported successful data in 
the clinical application. However, attaching multiple 
electromagnetic sensors on the surface of flexible endoscope 
makes it hard to insert it into the patient’s colon because of 
many wires and sensors around the flexible body. Possible 
infection is another problem.  
In this paper, we propose a shape prediction algorithm of 
the flexible colonoscope based on the information of only one 
electromagnetic sensor and the insertion length of the flexible 
body. For this, we model the colonoscope as an elastic 
kinematic chain having abundant joints and links. In other 
words, it is modeled as a kinematically-redundant system. 
Using this model, the shape prediction algorithm of the 
colonoscope is suggested for the given boundary condition. 
Numerical simulation is conducted to estimate the motion 
behavior of the elastic colonoscopy and experimental work is 
also performed to corroborate the effectiveness of the 
proposed algorithm.  
The procedure of this paper is as follows. In section II, 2D 
and 3D modeling of flexible continuum is introduced. 
Specifically, the flexible continuum used for the endoscope is 
modeled as a continuous spring wire since it possesses a coil 
spring inside the flexible body. In contrast to models of other 
continuum mechanisms of small size, we include the gravity 
load in the modeling of the flexible continuum. Using this 
model, we perform numerical simulation of the flexible 
continuum in section III. In order to verify the simulation 
result, we perform experiments in section IV. Finally, we draw 
conclusion. 
 
II. MODELING OF ELASTIC KINEMATIC CHAINS 
A. Continuum Modeling in 2-dimension 
We assume that the 2D continuum model of Fig. 1 belongs 
to 
2
WR ? and that it has infinite number of joints (at 
least 3 N? , where N is the number of links).  
The output coordinate of the ( 1) i? -th link can be 
expressed as a recursive form given by 
Shape Prediction Algorithm for Flexible Endoscope 
Jiun Jeon and Byung-Ju Yi, Member, IEEE 
2014 IEEE International Conference on Robotics & Automation (ICRA)
Hong Kong Convention and Exhibition Center
May 31 - June 7, 2014. Hong Kong, China
978-1-4799-3684-7/14/$31.00 ©2014 IEEE 2856
  
1
1
1
cos
( 1) ( ) sin ,
i ii
i i i
i i
x r
x i y x i r
?
?
? ?
?
?
?
?? ??
?? ??
? ? ? ?
?? ??
?? ??
?? ??
               (1) 
where 
i
r is the link length of the i -th module. 
 
Fig. 1. 2D Model of continuum 
 
In fact, a torsional spring is embedded inside the serial 
structure of colonoscopy. Therefore, we can model the 
colonoscopy as an elastic kinematic chain. Modeling the 
colonoscopy as N-lumped bodies, the potential energy of the 
i -th module is given by 
 
2
1
( ) ,
2
E i i
P i k? ?  (2) 
where 
i
k and 
i
? are the stiffness of the i -th module and the 
relative joint angle of the i -th joint, respectively. 
Then, the shape of the elastic kinematic chain will be 
formed in such a way to minimize the total potential energy of 
the N-moduled continuum. Thus, the optimization problem 
can be defined as 
0
Minimize ( )
cos
subject to ( 1) ( ) sin for all { }
(0) 0 & ( ) for some
N
E
i
i
i
i
Pi
r
x i x i r i 0,...,n
x x N b b W
?
?
?
?
? ? ? ?
? ? ?
??
??
??
??
??
?
       (3) 
B. Continuum Modeling in 3-Dimension 
 
Fig. 2. Modeling of one module in 3D 
In the 3-dimensional workspace, each module (link) of the 
continuum kinematic chain can be modeled as Fig. 2, which is 
composed of two universal joints and a link connecting them. 
The output space of the continuum kinematic chain belongs to 
6
WR ? . For redundancy, the continuum kinematic chain 
should have more than 3 links and 6 joints (26 N? ). 
The output of the ( i +1)-th module of the continuum 
kinematic chain is denoted as  
 
1
1
( 1) .
i
i
xi
?
?
??
??
??
??
P
Ω
  (4) 
In (4), 
1 i?
P is the position vector of the ( i +1)-th link and it is 
expressed as a recursive form given by 
 
1 1
1 1 1
1
0,
0
i i
i
i i i i i
i
r x
y
z
? ?
? ? ?
?
?? ??
?? ??
? ? ?
?? ??
?? ??
?? ??
P P R R  (5) 
where  
 
1
cos cos sin cos sin
sin cos cos sin sin .
sin 0 cos
i i i i i
i
i i i i i i
ii
?
???
??
?
??
?? ?
??
R
? ? ? ? ?
? ? ? ? ?
??
        (6) 
In (5), 
i
R is the rotation matrix of the i-th coordinate frame 
relative to the global frame and 
1
i
i?
R is the rotation matrix of 
the ( 1) i? -th frame relative to the ( i )-th frame, respectively. 
In (4), 
1 i?
Ω is the orientation vector, which is defined by three 
(Z-Y-X) Euler angles ( , , ). ??? The components of 
1 i?
Ω 
given by  
 ? ?
1 1 1 1
T
i i i i ? ? ? ?
? Ω ? ? ?  (7) 
are obtained by using 
1
i
ii?
RR . 
 In the 3-dimensional space, we can define a bending plane 
as Fig. 3 and the bent angle ? between two solid lines can be 
obtained from the geometry where the angles of the universal 
joint connecting two links are given as ? and . ? Then, the 
potential energy due to deflection of the continuum kinematic 
chain can be defined as 
2
1
( ) ,
2
E i i i i
P i k m gz ? ??             (8) 
where 
1
cos (cos cos ),
i i i
?
? ? ? ?
i
m is the mass of the i -th 
link, g is the gravity constant, and 
i
z is the height of the i -th 
module. 
 
Fig. 3. The bending plane  
2857
  
C. Secondary Criteria Optimizing Potential Energy of the 
System 
Yoshikawa [7-8] proposed redundancy resolution 
algorithms. Using the homogeneous space, the given 
performance criterion can be optimized. In the 2-dimensional 
space, the performance criterion denoting the total potential 
energy is expressed as 
 
2
00
1
( ) .
2
NN
E i i
ii
p P i k
??
??
??
?  (9) 
Differentiating (9) with respect to time gives 
 
0
,
N
iii
i
pk
?
? ? ?
?
B ??  (10) 
where ? ?
00 NN
kk ? B??  and ? ?
0
.
T
N
???? 
In the 3-dimensional space, the performance criterion is 
given by  
 
2
00
1
( ) .
2
NN
E i i i i
ii
p P i k m gz ?
??
??
? ? ?
??
??
??
   (11) 
Differentiating (11)  with respect to time gives 
 ? ?
? ?
0
,
N
i i i i
i
p k mgz ??
?
??
? ? ? ????
??
??
?? ??
?
?
BB
?
 (12) 
where  
 ? ?, ?
12
B B B  (13) 
1
0 0 0
0 0 0
22
0
00
1
22
cos (cos cos )
sin cos
1 cos cos
cos (cos cos )
sin cos
1 cos cos
T
i
n n n
n n n i
n
nn
z
k m g
z
k m g
? ? ?
??
??
??
? ? ?
??
??
??
?
?
??
?
??
?
??
??
?
??
??
? ??
???
??
1
B , (14) 
and 
1
0 0 0
0 0 0
22
0
00
2
1
22
cos (cos cos )
cos sin
1 cos cos
.
cos (cos cos )
cos sin
1 cos cos
T
i
n n n
n n n i
n
nn
z
k m g
z
k m g
? ? ?
??
??
??
? ? ?
??
??
??
?
?
??
?
??
?
??
??
?
??
??
? ??
???
??
B (15) 
The following steps are commonly applied irrespective of 
the dimension. The equation that relates the output x to the 
input ? is given by  
 ( ). xf ??  (16) 
Differentiating (16) with respect to time yields 
 . xJ ??  (17) 
Inverting (17), the solution of (17) is obtained as  
 ( ) ,
+
J x I - J J
?
?? ? ?  (18) 
where 
1
()
TT
J J JJ
??
? denotes the pseudo-inverse of J .  
The second term of (18) denotes the null-space which 
creates a self-motion inside the joint space. An arbitrary 
constant vector 
2N
R ? ? is decided to optimize some 
criterion. 
Substituting (18) into (12), we have  
 ( ) . p J x I J J
??
? ? ? BB ?  (19) 
If we propose to select ? as 
 
1
,
T
?? ? B  (20) 
where 
1
? is a constant. Hence we obtain 
 
1
( ) ,
T
p J x I J J ?
??
? ? ? B B B          (21) 
where if we set 
1
? as a negative value, the second term in the 
right-hand side of (21) becomes nonnegative due to the fact 
that ()
T
I J J
?
? BB is non-negative, contributing to an 
decrease of the value p (minimize the total potential 
energies).  
Integrating (18) with respect to time, we can obtain the 
joint angles and are able to draw the shape of the colonoscope. 
 
III. SIMULATION 
A. 2D simulation 
First of all, we perform some basic 2D simulations to show 
how the shape prediction algorithm works for elastic 
kinematic chain. The elastic kinematic chain is modeled as 
having 10 joints and 10 links. Fig. 4 demonstrates that the 
initial input state transits to the final state in such a way to 
minimize the potential energy of the system. It is noted from 
Fig. 5 that the total potential energy of the system converges to 
a constant value. Fig. 6 also demonstrates different shapes of 
the elastic kinematic chain according to different output 
boundary conditions (position and orientation of the end 
point). 
 
Fig. 4. Shape transition of the elastic kinematic chain 
 
Fig. 5. Potential energy of the system 
2858
  
 
Fig. 6. The shapes with respect to output boundary conditions 
 
B. Simulation for constrained case 
Fig. 7 denotes the X-ray image of a flexible endoscope, 
which is taken during colonoscopy. It is observed that the 
flexible endoscope is constrained to the left and right walls 
and peritoneum.  Thus it is necessary to consider the 
anatomical constraint for precise shape prediction. To our 
knowledge, there is no prior work that deals with shape 
prediction with consideration of the anatomical constraint as 
shown in Fig. 7. 
 
 
Fig. 7. X-ray image of the flexible endoscope. 
 
As an initial study for this problem, we construct a test 
platform to deal with this problem. Fig. 8 shows comparison 
of simulation and experimental results for this case. The slim 
yellow line laid over the flexible body denotes the simulation 
result. In order to represent the simulation result, VTK 
(Visualization Tool Kit) was employed to visualize the shape. 
It is clearly shown that without reflecting the constrained 
geometry the simulation result of Fig. 8(a) is different from the 
shape of the endoscope. This is because the force exerted on 
the flexible body by the left wall was not modeled in the shape 
prediction algorithm. So it is necessary to measure the force 
distribution along the surface of the flexible body. However, 
this approach is not practical because it is hard to implement 
sensors on the surface of the flexible endoscope. Thus we 
adopt an indirect way. First of all, using the X-ray image of a 
patient, we can design the planar abdominal model of the 
patient. Using this information, the boundary of the endoscope 
can be estimated. Then we tune the stiffness of the continuum 
model. In the definition of potential energy of (11), the 
stiffness of each individual continuum module can be variable. 
In other words, if we set the stiffness of some continuum 
modules in the neighborhood of the contacting wall as very 
large values, the corresponding joints won’t deflect much as a 
result of minimizing the potential energy. Thus, through this 
kind of post-processing, we could reshape the simulation 
result almost identical to the experimental result as shown in 
Fig. 8(b). 
 
  
(a) without modification algorithm      (b) with modification algorithm 
Fig. 8. Reshaping the simulation result by including the wall model. 
 
IV. EXPERIMENTAL WORK 
In order to corroborate the simulation result, we conducted 
experimental work. Aurora, which is an Electromagnetic 
Tracking System (EMTS), was employed to predict the shape 
of the colonoscopy. For experiment, we set up the test 
environment such that the proximal boundary condition is 
identical to the real colonoscopy inspection. The proximal end 
of the wire is clamped and fixed to a wall. For this experiment, 
we employ only two pieces of information: one electro- 
magnetic sensor and the inserted length of the flexible 
endoscope. The electromagnetic sensor returns three positions 
and three orientation of the distal end of the endoscope. 
The same elastic wire used in colonoscopy whose length is 
50cm was employed. One electromagnetic sensor is attached 
at the distal end of the flexible endoscope as shown in Fig. 9.  
 
 
Fig. 9. Electromagnetic Tracking System (EMTS) 
 
2859
  
     
(a) Experimental result                  (b) Simulation result 
Fig. 10. 2D wire prediction using electromagnetic tracking system 
 
 
Fig. 11. 2D wire prediction for a complex shape 
 
  
Fig. 12. 2D experiment for the constrained case 
 
Fig. 10 and Fig. 11 denote comparison of simulation and 
experimental results. Even for a complex shape of the flexible 
endoscope, the shape prediction algorithm works very well. 
2D experiment for the constrained case was also performed. It 
is noted from Fig. 12 that reshaping the stiffness model of the 
continuum modules in the neighborhood of the peritoneum, 
we could exactly match the simulation result to the 
experimental result.  
In most motion estimation algorithms [9-11] of continuum 
mechanisms, the gravity effect has not been taken into account 
because of adapting the assumption of negligible weight of a 
small-sized continuum body. On the contrary, the flexible 
endoscope has considerable amount of weight, so the gravity 
load should be included in the shape prediction algorithm. In 
the 3D simulation, the continuum is modeled as having 8 links 
and 16 joints. Fig. 13(a) and Fig. 13(c) denote the shapes of 
the continuum without taking into account the gravity load in 
the potential energy model given by (11). However, when 
considering the gravity effect, it is clearly shown from the Fig. 
13(b) and Fig. 13(d) that the simulation result is almost 
identical to the experimental result.  
Thus, it is concluded that the proposed shape prediction 
algorithm is effective to estimate the shape of the colonoscope 
being inserted into the colon. 
 
 
(a) without consideration of gravity effect (case 1) 
 
 
(b) with consideration of gravity effect (case 1) 
 
 
(c) without consideration of gravity effect (case 2 and 3) 
 
 
(d) with consideration of gravity effect (case 2 and 3) 
Fig. 13. Comparison of simulation and experimental result for 3D case 
 
V. CONCLUSION 
The contribution of this paper is the shape prediction of 
colonoscopy which has the nature of elastic continuum. Given 
boundary conditions, the proposed optimization algorithm 
was able to predict the whole shape of the continuum both 
under constrained geometry and under gravity. Through 
experimental work, the feasibility of the proposed algorithm 
was verified. As a future work, the lumped continuum model 
2860
  
employed in this paper should be replaced by continuous 
continuum model which eventually minimizes the 
computation time and increase the accuracy of the shape 
prediction. Another future work is application of this shape 
prediction algorithm to real colonoscopy operation in the 
clinic. 
ACKNOWLEDGEMENT 
This work was supported by the BK21 Plus 
Program(Future-oriented innovative brain raising type, 
22A20130012806) funded by the Ministry of 
Education(MOE, Korea) and National Research Foundation 
of Korea(NRF), supported by the Technology Innovation 
Program (10040097) funded by the Ministry of Trade, 
Industry and Energy Republic of Korea (MOTIE, Korea), 
supported by GRRC program of Gyeonggi Province (GRRC 
HANYANG 2013-A02), and financially supported by the 
Ministry of Trade, Industry and Energy (MOTIE) and Korea 
Institute for Advancement in Technology (KIAT) through the 
Workforce Development Program in Strategic Technology, 
supported by the MOTIE(The Ministry of Trade, Industry and 
Energy), Korea, under the Robotics-Specialized Education 
Consortium for Graduates support program supervised by the 
NIPA(National IT Industry Promotion Agency) 
(H1502-13-1001) 
REFERENCES 
[1] H.-S. Yoon, J. Jeon, J. H. Chung, and B.-J. Yi, "A Continuum module 
for developing a biopsy device," in Proc. of Int. Conf. on Ubiquitous 
Robots and Ambient Intelligence, pp. 442-444, 2012. 
[2] H.-S. Yoon, S. M. Oh, J. H. Jeong, S. H. Lee, B.-J. Yi, K. Tae, and K.-C. 
Koh, "Active bending endoscope robot system for navigation through 
sinus area," in Proc. of IEEE/RSJ Int. Conf. on Intelligent Robots and 
Systems, pp. 967-972, 2011. 
[3] D. B. Camarillo, C. F. Milne, C. R. Carlson, M. R. Zinn, and J. K. 
Salisbury, "Mechanics modeling of tendon-driven continuum 
manipulators," IEEE Transactions on Robotics, vol. 24, 2008, pp. 
1262-1273. 
[4] R. Jansen, K. Hauser, N. Chentanez, F. van der Stappen, and K. 
Goldberg, "Surgical retraction of non-uniform deformable layers of 
tissue: 2D robot grasping and path planning," in Proc. of IEEE/RSJ Int. 
Conf. on Intelligent Robots and Systems, pp. 4092-4097, 2009. 
[5] M. W. Hannan and I. D. Walker, "Kinematics and the implementation 
of an elephant's trunk manipulator and other continuum style robots," 
Journal of Robotic Systems, vol. 20, 2003, p. 45-63. 
[6] B. A. Jones and I. D. Walker, "Kinematics for multisection continuum 
robots," IEEE Transactions on Robotics, vol. 22, 2006, pp. 43-55. 
[7] T. Yoshikawa, "Analysis and control of robot manipulators with 
redundancy," The first Int. symposium in Robotics research, 1984, pp. 
735-747. 
[8] T. Yoshikawa, "Manipulability and redundancy control of robotic 
mechanisms," in Proc. of IEEE Int. Conf. on Robotics and Automation, 
1985, pp. 1004-1009. 
[9] T. Bretl and Z. McCarthy, "Equilibrium configurations of a kirchhoff 
elastic rod under quasi-static manipulation," in Proc. of Workshop on 
Algorithmic Foundations of Robotics, 2012. 
[10] T. Bretl and Z. McCarthy, "Mechanics and quasi-static manipulation of 
planar elastic kinematic chains," IEEE Transactions on Robotics, vol. 
29, 2013, pp. 1-14. 
[11] D. Matthews and T. Bretl, "Experiments in quasi-static manipulation of 
a planar elastic rod," in Proc. of IEEE/RSJ Int. Conf. on Intelligent 
Robots and Systems, pp. 5420-5427, 2012. 
[12]  S. Shah, H. Pearson, S. Moss, E. Kweka, P. Jalal, and B. Saunders, 
"Magnetic endoscope imaging: a new technique for localizing colonic 
lesions," Endoscopy, vol. 34, 2002, pp. 900-904. 
[13]  S. G. Shah, B. P. Saunders, J. C. Brooker, and C. B. Williams, 
"Magnetic imaging of colonoscopy: an audit of looping, accuracy and 
ancillary maneuvers," Gastrointestinal endoscopy, vol. 52, 2000, pp. 
1-8.  
 
 
 
 
 
2861
