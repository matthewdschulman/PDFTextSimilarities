A System for Automated Counting of Fetal and Maternal Red Blood
Cells in Clinical KB Test
J. Ge
1
, Z. Gong
1
, J. Chen
1
, J. Liu
1
, J. Nguyen
1
, Z.Y . Yang
1
, C. Wang
2
, and Y . Sun
1
Abstract— The Kleihauer-Betke test (KBT) is a widely used
method for measuring fetal-maternal hemorrhage (FMH) in
maternal care. In hospitals, KBT is performed by a cer-
tiﬁed technologist to count a minimum of 2,000 fetal and
maternal red blood cells (RBCs) on a blood smear. Manual
counting is inherently inconsistent and subjective. This paper
presents a system for automated counting and distinguishing
fetal and maternal RBCs on clinical KB slides. A custom-
adapted hardware platform is used for KB slide scanning and
image capturing. Spatial-color pixel classiﬁcation with spectral
clustering is proposed to separate overlapping cells. Optimal
clustering number and total cell number are obtained through
maximizing cluster validity index. To accurately identify fetal
RBCs from maternal RBCs, multiple features including cell size,
shape, gradient and saturation difference are used in supervised
learning to generate feature vectors, to tackle cell color, shape
and contrast variations across clinical KB slides. The results
show that the automated system is capable of completing the
counting of over 60,000 cells (vs. 2,000 by technologists) within 5
minutes (vs. 15 minutes by technologists). The counting results
are highly accurate and correlate strongly with those from
benchmarking ﬂow cytometry measurement.
I. INTRODUCTION
In North America, there are over 6 million pregnancies
annually. Rhesus D hemolytic disease of the newborn (RhD
HDN) is a serious alloimmune condition, where fetal red
blood cells (RBCs) are destroyed by the maternal immune
system through the placenta. During pregnancy or child
birth, the mother may be exposed to the infant’s blood, and
this causes the development of antibodies (IgG) against the
Rhesus antigen, which can destruct the Rh positive fetal
RBCs by passing through the placenta into the fetus and
lead to hemolysis [1]. Fetal-maternal hemorrhage (FMH) can
have devastating consequences for fetus, such as anemia,
hydrops, neurologic injury, erythroblastosis, stillbirth, and
neonatal death. Hence, quantiﬁcation of FMH is necessary
for physicians to make treatment decisions, for instance, the
administration of an appropriate therapeutic dose of RhD
immune globulin (RhIG) [2].
Besides Rh diseases, FMH can also result from the loss of
integrity of the normal physiological barrier between the fetal
and maternal circulation, which must be quantiﬁed in preg-
nancy care for prompt treatment (e.g., blood transfusion) [3].
The standard clinical method of quantitating FMH is the KB
test [4]. The test takes advantage of the differential resistance
of fetal and maternal hemoglobin to acid (fetal hemoglobin
1
The authors are with Dept. of Mechanical and Industrial Engineering,
University of Toronto, 5 King’s College Road, Toronto, ON M5S 3G8,
Canada sun@mie.utoronto.ca
2
Chen Wang is with Mount Sinai Hospital, 600 University Ave., Toronto,
ON M5G 1X5 Canada cwang@mtsinai.on.ca
(a)
fetal 
RBCs
maternal 
RBC
(b)
weak positive 
fetal RBC
maternal 
RBCs
(d)
contaminant
(c)
neutrophil
(f)
broken 
RBC
(e)
overlapping
5?m
5?m 5?m 5?m
5?m 5?m
Fig. 1. Sample images from clinical KB slides. (a) ‘canonical’ fetal
and maternal RBCs; (b) weak positive fetal RBC; (c) neutrophils; (d)
contaminant; (e)(f) severally overlapping and broken RBCs.
is signiﬁcantly more resistant). A standard blood smear is
prepared from the mother’s blood (1:1,000 dilution with
PBS). After drying, staining and incubating, the blood smear
slides are counted under a microscope by certiﬁed personnel.
Since the fetal hemoglobin is resistant to the citrate buffer,
the resulting bright-pink cells are classiﬁed as fetal cells [see
Fig. 1(a)]. The percentage of FMH can then be calculated
[5].
In present clinical practice, fetal RBCs and total number
of RBCs are manually estimated by certiﬁed technologists
who look into the eyepieces of a microscope and count
a minimum of 2,000 cells. Inherently, manual KB test
is subjective and inconsistent, which can often result in
underestimation/overestimation of fetal RBC count and wide
variations across technologists and hospitals [6].
Flow cytometry is an accepted benchmark technique
for counting fetal and maternal RBCs, based on the fetal
hemoglobin-speciﬁc antibody. The ﬂow cytometric analysis
of FMH involves multiple pre-treatment steps, which requires
more than 30 minutes pre-process and has high personnel-
skill requirements [7]. Due to these limitations, ﬂow cy-
tometry testing is typically unavailable during after hours
in hospitals. The infrastructure cost along with operating
and reagent costs also limits the clinical routine use of ﬂow
cytometry for KB tests [8]. The adoption of ﬂow cytometry
for fetal/maternal RBC counting has been discussed for two
decades in transfusion medicine [9]; however, the state-of-
the-art practice in most hospitals for quantifying FMH is still
2014 IEEE International Conference on Robotics & Automation (ICRA)
Hong Kong Convention and Exhibition Center
May 31 - June 7, 2014. Hong Kong, China
978-1-4799-3684-7/14/$31.00 ©2014 IEEE 1706
manual KB test that relies on manual counting of fetal and
maternal RBCs.
Fig.1(a) shows canonical fetal and maternal RBCs that
can be easily counted and distinguished. However, many
KB slides have more complex patterns that make the tasks
difﬁcult. As shown in Fig.1(b)-(f), KB slide preparation (in-
herent difference in blood samples and staining unevenness)
often results in cell overlapping; the presence of random
contaminants; variations in cell color, size and shape; con-
trast variations between cells and slide background across
KB slides. Fetal RBC identiﬁcation is also made challenging
due to the existence of neutrophils and weak positive fetal
RBCs. Automated RBC counting requires the segmentation
of overlapping cells and the identiﬁcation of fetal RBCs to be
properly and reliably handled. A few attempts were made to
automate fetal and maternal RBC counting [6], [10], where
automation in these works refers to the use of commercial
motorized stage to capture cell images. Fetal RBCs were
distinguished from maternal RBCs based on intensity and
distribution patterns of staining by a technologist. The total
cell number on a KB slide was also manually estimated. No
system exists that is capable of automated counting of total
RBC numbers and fetal RBCs.
A number of image segmentation methods have been
reported for cell counting. Non-maximum suppression and
seeded region growing were applied to segment corneal
epithelial cells [4]. A critical issue in automated cell counting
is to effectively segment overlapping cells. Major approaches
for separating overlapping cells include watershed [11], tem-
plate matching [12], and color-texture based segmentation
[13]. Due to the existence of regional maxima, the watershed
algorithm often leads to over segmentation. Template match-
ing has low efﬁciency and requires large quantities of cell
samples to achieve reasonable accuracy. Overlapping cells
with close colors or textures can be clustered by color-texture
based segmentation [13]; however, they cannot be separated
from each other for quantiﬁcation.
Due to the complex characteristics of RBCs on clinical
KB slides, spectral clustering with spatial-color information
is proposed in this paper to segment overlapping cells. Each
cell can be considered a cluster since the color within a
cell is relatively homogeneous. Besides color values, spatial
information of each cell is also added to construct features
used for generating similarity matrices. Cluster validity index
is then used for determining the number of clusters.
To distinguish fetal RBCs from maternal RBCs, color in-
formation is the foremost cue. Due to variations in cell color,
size, and the overlapping extent across KB slides, relying
solely on saturation channel information is unreliable. Hence,
supervised clustering method is used in our system for fetal
RBC identiﬁcation, where feature vector is constructed with
cell color, size, shape, gradient, saturation difference between
a cell and the whole slide.
II. SYSTEM DESIGN
As shown in Fig. 2, the system consists of a standard
optical microscope, the manual stage of which was motorized
camera
control 
board
step
motor
motorized
stage 
KB
slide
Fig. 2. System for automated image capturing and counting of fetal and
maternal RBCs on clinical KB slides.
with timing belts, pulleys, and stepping motors. The motor-
ized stage has a positioning accuracy of§19mm and§26mm
along the X and Y directions. The resolution is comparable
for each direction and is 20§3mm. Travel distances for
positioning a KB slide are 10mm and 35mm along X and Y ,
respectively. Due to the non-uniform distribution of RBCs
on a KB slide, which is more severe on the far left and far
right parts of the slide, images should be captured around
the slide center. Hence, two motion limit switches along the
X and Y directions are added for automatic slide centering.
Under a 20£ objective, the system typically captures 120
images around the slide center (image size: 2560£1920) for
automated counting.
FMH quantiﬁcation and RhIG drug dose calculation rely
on accurately determining the percentage of fetal RBCs.
The number of vials (300 mg/vial) of RhIG administered
to patients is calculated as [14]
N
vial
=
2370¢
p
h¢ w=3131¢ N
Fetal
30¢ N
Total
+ 1 (1)
where h and w are the height and weight of the patient.
N
Fetal
and N
Total
denote the fetal RBC number and total RBC
number among the RBCs counted on the KB slide, which
must be accurately counted.
III. TOTAL RBC COUNTING
Fig. 1(e) shows an example of cell overlapping that must
be reliably handled to achieve accurate counting of the
total number of RBCs. To begin with, a target needs to
be determined to be an isolated cell or overlap with other
cells. For this purpose, we use the concavity points searching
method [15]. If a cell is isolated without any concavity
points, the cell is counted as one cell directly. Otherwise,
segmentation as discussed below is conducted.
In overlapping RBCs, each cell forms a cluster due to
the similar color within the same cell. Hence, segmenting
overlapping cells can be considered cluster analysis. Among
existing clustering methods, the k-means algorithm is ef-
fective only for clusters with similar sizes and densities, a
condition that is not true in overlapping RBCs on a KB
1707
START
capture one image from camera
convert to gray image
binarize the gray image through a 
dynamic thresholding method
distance transform
determining the 
number of clusters via 
clustering validation
calculate the optimal 
number of clusters (k)
eclipse fitting on edge 
points of the clusters 
total cell counting
END
feature construction based on 
cell color and coordinates
spectral clustering with  
generated feature
cell extraction
single cell?
count 
directly
calculate the regional 
maxima and preprocessing
YES
NO
Fig. 3. Flow chart of total RBC counting.
slide. Furthermore, the k-means algorithm is sensitive to
initial centers and usually converges to a local optimum.
In comparison, the spectral clustering algorithm (SC) [16]
is capable of recognizing clusters with unusual shapes and
obtaining global optimal solutions with eigen-decomposition.
Unfortunately, only depending on cell color, the SC al-
gorithm can mistakenly group those pixels belonging to
different RBCs although they locate far from each other in
the image.
Hence, in our system, spatial information (i.e., pixel co-
ordinates) besides color is used to generate feature vectors
used for calculating the similarity matrix of SC. This spatial
and color-based spectral clustering approach is proven in our
work effective in separating overlapping RBCs. Fig. 3 shows
the sequence of processing for counting the total number of
RBCs on a KB slide. Key steps are highlighted in blue and
described in the following sub-sections.
A. Regional Maxima Preprocessing
We observed that many extracted regional maxima in a
distance image are located closely (Fig. 4(b)). If overlapping
cells are segmented directly with the number of regional
maxima, over segmentation often occurs. Thus, we deﬁned a
distance-dependent rule to eliminate those spurious maxima.
repeat
8m=(x
m
;y
m
)2 S
if9n=f(x
n
;y
n
)jD(m;n)6 D
T H
)g then
select p=fm;njmax(x
m
;x
n
)g
update S
end if
until no changes in S
where m and n are regional maxima within maxima set S;
D is the Euclidean distance between two arbitrary maxima;
D
T H
is the minimal distance threshold. Considering that the
radius of typical RBCs is approximately 20 pixels under a
20£ microscope objective, D
T H
in our system is set to 10.
If the Euclidean distance D(m, n) between point m and n
Fig. 4. Cluster number determination. (a) Original image; (b) regional
maxima (blue arrow labeled); (c) spurious maxima eliminated; (d) spectral
clustering result with k=3, SV
3
= 0.1652; (e) spectral clustering result with
k=2, SV
2
= 0.6173; (f) edge points with two clusters; (g) ellipse ﬁtting.
is smaller than 10, the point with larger coordinate in the x
direction is selected into the set S (see Line 3 and Line 4 of
the rule). Fig. 4(c) shows that spurious maxima are removed
after regional maxima preprocessing.
B. Determination of Optimal Number of Clusters
In cluster analysis of overlapping cells, the initial number
of clusters is obtained through counting the number of
local maxima after regional maxima preprocessing, and then
cluster validation is applied to determine the number of
overlapping cells. Cluster validity index SV [17], consisting
of two evaluation criteria of the cells (i.e., separation S and
compactness V ), is
SV(k;V;X)=
S
k
V
k
=
å
k
i=1
min
j2[1;:::;k];i6= j
d(v
i
;v
j
)
å
k
i=1
max
x
j
2C
i
d(x
j
;v
i
)
(2)
where X =fx
j
; j = 1;2;¢¢¢;ng denotes the dataset with n
data points. Dataset X then can be partitioned into k clusters
C
i
and each cluster has a centroid v
i
, here i = 1;2;¢¢¢;k.
Separation measure S
k
is the sum of pairwise minimal inter-
cluster distances in a k-cluster structure while compactness
measure V
k
indicates how different the members of each
cluster are. The smaller of value V
k
is, the compacter of the
clusters are. The optimal cell number is obtained through
maximizing the SV index.
As an example shown in Fig. 4(d)(e), SV
2
=0.6173 is larger
than SV
3
=0.1652, indicating that the result of segmentation
is more appropriate with two clusters. In Fig. 4(e), after
determining the optimal number of clusters and generating
features based on cell color and spatial coordinates, the
system applies spectral clustering to classify the overlapping
cells (labeled red and green). Subsequently, contours in the
overlapped areas are predicted via ellipse ﬁtting [18] (Fig.
4(g)) since most RBCs on a KB slide have circle-like or
ellipse-like shapes.
IV. FETAL RBC IDENTIFICATION
In manual KB test, fetal RBC identiﬁcation is conducted
through human visual inspection relying on cell patterns such
1708
original color images
convert to HSV
color space and generate the matrix
Model 2 Model 1
MoG 
Training
color image with cells
Use
Model 1, 2
Labeled
k-NN
kNN_Model
(Model 3)
k-NN
cell 
extraction
feature
calculation
Fetal cell
determination
training
prediction
Fig. 5. Flowchart of supervised learning for identifying fetal RBCs.
as color, size, shape, and texture [6]. However, feature vari-
ations across KB slides exist although hospital technologists
closely follow slide preparation protocols. In our system,
supervised learning is used, and the process is illustrated
in Fig. 5.
As shown in Fig. 5, all the 120 raw color images are
read into the memory and converted to the hue, saturation,
value (HSV ) color space. An N£3 dimensional matrix X
1
constructed with all image pixels’ H, S, and V values is ﬁt
with a two-component Gaussian mixture distribution. Here,
N equals to 2560£1920£120, and Model 1 is generated
for separating all RBC pixels from background pixels. In
the converted color space, fetal and maternal RBCs show
signiﬁcant differences in the saturation channel. Therefore,
combining saturation values of the cells singled out by
Model 1 forms N
Scell
£1 matrix X
2
. Model 2 is generated for
separating fetal RBCs from maternal RBCs, ﬁt with another
two-component Gaussian mixture distribution.
In captured color images, fetal RBCs appear red-colored,
brilliant, shining, and smooth inside while maternal ones
appear light and pinkish. Therefore, color information is used
to identify fetal cells. Due to cell variations across KB slides,
besides color information, our system also integrates other
features, such as cell size, roundness, gradient, saturation
difference between a cell and the whole slide, to distinguish
fetal RBCs from maternal ones. Based on these features,
the system applies a non-parametric learning algorithm (k-
nearest neighbor, kNN) via supervised learning to improve
RBC classiﬁcation accuracy. The kNN method is suitable
for this purpose since it is not certain whether the generated
feature vectors of the fetal or maternal RBCs will satisfy
such assumptions as Gaussian mixtures and linear separation.
Additionally, the kNN method does not generalize the many
training vectors and makes decisions based on the entire
training feature vectors.
In this paper, more than 3,500 cells (labeled “positive” or
“negative”) were calculated for generating feature vectors.
Feature=(H
i
;S
i
;V
i
;R
i
;G
i
;B
i
;Gd
i
;D
i
) (3)
where i = 1,2,¢¢¢,3500; H, S, V , R, G, and B denote six
channel values in HSV and RGB color space; Gd is the
gradient of the cell; D is the saturation difference between
cell and whole slide.
A kNN model (Model 3) is built after ﬁtting the feature
vector with the kNN algorithm. Features of extracted cells
are calculated and predicted with Model 3 where similarity
of RBCs is calculated and veriﬁed according to
?
V
i
FC
= 1; p
i
> T h
f
V
i
FC
= 0; others
(4)
where V
i
FC
denotes the fetal RBC indicator of ith cell. p
i
represents similarity between ith cell and labeled “positive”
cells. T h
f
denotes the fetal RBC threshold value. Typically,
this threshold value is set to 0.5 according to statistical char-
acteristics gathered from more than 50 clinical KB slides.
Therefore, fetal RBC number is determined by å
N
i=1
V
i
FC
,
where N is the total cell number in the 120 images.
V. EXPERIMENTAL RESULTS AND DISCUSSION
A. Total RBC Counting
Fig. 6 shows overlapping cells randomly selected from KB
slides. Comparisons between marker-controlled watershed
[11], color and texture based segmentation algorithm [13], k-
means clustering algorithm, and our proposed spatial-color-
based spectral clustering approach are made.
Column (a) to (c) show slightly overlapping situations
where almost all the algorithms segmented cells reasonably
well, except that over segmentation occurred in (2, a) due to
the wrong markers that existed within the overlapping area
(arrow labeled). For the more severally overlapping situations
(see column (d) to (f)), marker-controlled watershed in row 2
yielded over segmentation due to many spurious maxima that
appeared in the overlapping areas. k-means clustering in row
4 divided the overlapping cells into several regions; however,
it led to erroneous segmentations due to the incorrect initial
centers and number of clusters.
Most cell pixels were extracted with the color and texture
clustering method, as shown in (3, a), (3, b) and (3, e).
Unfortunately, only some scattered pixels or contours were
picked out in other three columns in row 3, due to color and
texture unevenness of the RBCs. This algorithm can extract
the cells out but is not effective in separating them from each
other. Our proposed algorithm (spatial-color-based spectral
clustering) generates a new feature vector by adding spatial
information into the original color matrix, which is proven
effective in segmenting overlapping cells (see row 5 in Fig.
6). Furthermore, contour ﬁtting on the overlapping cells
generates clear ellipse-like contours for cell quantiﬁcation.
Fig. 7 shows the segmentation and counting results of one
KB image. The overlapping cells were segmented, and their
contours were labeled with black ellipses. Those isolated
cells, labeled with blue plus symbols, were counted directly
without segmentation procedures. To evaluate the accuracy
1709
(a) (d) (e) (f) (b) (c)
1
2
3
4
5
6
Fig. 6. Segmentation results using different algorithms. (1) original
image; (2) marker-controlled watershed [11]; (3) color and texture based
segmentation [13]; (4) k-means algorithm; (5)(6) our proposed spatial-color
based spectral clustering; and ellipse ﬁtting on cell contours.
Fig. 7. Automated total RBC counting. Isolated RBCs are labeled with
blue plus. Overlapping cells are segmented and ﬁt with black eclipses.
of total RBC counting, 8 KB images were randomly selected
and counted with the marker-controlled watershed method,
our proposed spatial-color spectral clustering algorithm, and
manual counting. Manual counting was conducted by a
skilled technologist who used computer mouse clicking to
count every cell in the images and then spent signiﬁcant time
carefully verifying every single cell. The manual counting
results were used to calculate over-counting and under-
counting rates summarized in Table I.
The marker-controlled watershed algorithm resulted in
much higher over-counting ratios, ranging from 13% to
20%, due to its nature in severe over segmentation. Our
proposed algorithm performed signiﬁcantly better in terms
of both over-counting and under-counting rates. Scrutinizing
the segmentation results using our spatial-color spectral clus-
tering approach, we observed that some under-counted cells
were missed because of their signiﬁcantly lower contrasts
compared to surrounding cells. There were only 3 to 6
cells over-counted, and veriﬁcation revealed they were cells
broken into more than one segment, as illustrated in Fig. 1(f).
TABLE I
TOTAL CELL COUNTING (UC: UNDERCOUNTED; OC: OVERCOUNTED)
Img
technologist marker-controlled watershed proposed algorithm
#total #UC/ratio #OC/ratio #total #UC/ratio #OC/ratio #total
1 584 15 /2.27% 92 / 13.9% 661 6 / 1.03% 4 / 0.69% 582
2 669 12 / 1.57% 105 / 13.8% 762 9 / 1.35% 6 / 0.90% 666
3 531 10 / 1.67% 79 / 13.2% 600 3 / 0.56% 3 / 0.56% 531
4 543 8 / 1.28% 88 / 14.1% 623 5 / 0.92% 3 / 0.55% 541
5 611 17 / 2.37% 122 / 17.0% 716 5 / 0.82% 1 / 0.16% 607
6 624 15 / 2.11% 101 / 14.2% 710 7 / 1.13% 4 / 0.64% 621
7 643 20 / 2.57% 156 / 20.0% 779 10 / 1.57% 4 / 0.63% 637
8 653 18 / 2.32% 141 / 18.2% 776 8 / 1.23% 3 / 0.46% 648
TABLE II
COUNTING RESULTS: AUTOMATED COUNTING; MANUAL COUNTING
BY TECHNOLOGIST
Group Slide
Automated
Technologist Known
#Fetal #Total Ratio
1
1 89 79273 0.11% 0.09%
0.1% 2 73 86144 0.09% 0.13%
3 95 103216 0.09% 0.11%
2
1 389 82669 0.47% 0.52%
0.5% 2 442 86584 0.51% 0.55%
3 400 81649 0.49% 0.49%
3
1 702 75675 0.93% 0.89%
1% 2 749 77148 0.97% 0.91%
3 811 80261 1.01% 1.05%
B. Fetal RBC Counting and Blind KB Tests
To quantify the accuracy of fetal cell identiﬁcation using
supervised learning, nine slides (three per group) with known
fetal cell concentrations (0.1%, 0.5% and 1%) were tested.
These ‘artiﬁcial’ KB slides were prepared through accurately
controlled mixing of fetal blood from umbilical cord and
adult RBCs. Results from automated counting and hospital
technologist reading are summarized in Table II.
Data in Table II is graphically shown in Fig. 8. Our
automated system determined on the nine ‘artiﬁcial’ KB
slides average fetal RBC concentrations to be 0.097%, 0.49%
and 0.97% with standard deviations of 0.012%, 0.02%, and
0.04%. The results from technologist reading were 0.11%,
0.52% and 0.95% with standard deviations of 0.02%, 0.03%,
and 0.09%. Compared to the known mixing ratios on these
‘artiﬁcial’ KB slides, the results quantitatively conﬁrmed
the automated system’s capability for highly accurate RBC
counting. Note that our automated system counted over
60,000 cells per KB slide while standard technologist reading
was limited to 2,000 cells. Additionally, automated counting
is completed within 5 minutes per slide while manual reading
costs»15 minutes.
Another 44 KB slides were made from pregnant pa-
tient samples collected in the Mount Sinai Hospital were
Fig. 8. Comparison between technologist reading and automated counting.
1710
y = 1.011x + 9E-05
R
2
 = 0.9753
0.00%
0.10%
0.20%
0.30%
0.40%
0.50%
0.60%
0.70%
0.80%
0.90%
0.00% 0.20% 0.40% 0.60% 0.80% 1.00%
automated system
flow cytometry
A
B
Fig. 9. Correlation between automated counting and ﬂow cytometry in 44
pregnant patient samples (R
2
=0.9753).
tested. Testing results using our automated system strongly
correlated with those from benchmarking ﬂow cytometry
measurement (R
2
=0.9753 shown in Fig. 9 vs. R
2
=0.9436
between technologist reading and ﬂow cytometry, data not
shown). Counting accuracy is deﬁned as
Accuracy=
T P+ T N
T P+ T N+ FP+ FN
(5)
where T P is the number of true positives, FP is the number
of false positives, T N is the number of true negatives and
FN is the number of false negatives. The counting accuracy
of our automated system was quantiﬁed to be 0.984§0.09
(vs. 0.926§0.15 in technologist reading).
C. Discussion
The data points labeled ‘A’ in Fig. 9 are those fetal
concentrations determined by the automated system to be
lower than ﬂow cytometry. We re-evaluated those slides
and observed that colors of some fetal RBCs appeared
much lighter compared to ‘canonical’ fetal RBCs shown
in Fig. 1(a). These lighter fetal RBCs were considered by
the automated system negative. For those slides (labeled
‘B’) with higher fetal RBC concentrations than determined
by ﬂow cytometry, some negative RBCs appeared darker
and brighter than surrounding cells, leading to higher false
positives. Our next step is to include more patient samples
and larger training datasets to further improve the automated
system’s accuracy and correlation with ﬂow cytometry.
VI. CONCLUSION
This paper described an automated system for fetal and
maternal RBC reading in clinical KB test. The system uses a
custom-motorized image capturing platform to automatically
center a KB slide, collect»120 images (over 60,000 cells),
and count/distinguish fetal and maternal RBCs. Spatial-
color classiﬁcation with spectral clustering is proposed to
effectively count overlapping cells. Multiple features includ-
ing cell color, size, shape and contrast variations are used
in supervised learning for distinguishing fetal RBCs and
maternal ones. Testing patient KB slides, the automated sys-
tem quantitatively demonstrated high accuracy in counting
and strong correlation with benchmarking ﬂow cytometry.
Compared to manual technologist reading, the automated
system is signiﬁcantly more efﬁcient and accurate.
REFERENCES
[1] J. M. Bowman, B. Chown, M. Lewis, and J. M. Pollock, “Rh
isoimmunization during pregnancy: antenatal prophylaxis.” Canadian
Medical Association journal, vol. 118, no. 6, pp. 623–7, Mar. 1978.
[2] C. Chen, S. Cheng, C. Lee, F. Chang, C. Wu, and Y . Yuh, “Fetoma-
ternal Hemorrhage,” Journal of Medical Science, vol. 23, no. 4, pp.
231–234, 2003.
[3] Z. Wang, J. Shi, Y . Zhou, and C. Ruan, “Detection of red blood cell-
bound immunoglobulin G by ﬂow cytometry and its application in the
diagnosis of autoimmune hemolytic anemia.” International journal of
hematology, vol. 73, no. 2, pp. 188–93, Feb. 2001.
[4] N. Bandekar, A. Wong, D. Clausi, and M. Gorbet, “A novel approach
to automated cell counting for studying human corneal epithelial
cells.” in International Conference of the IEEE EMBS, Boston, Jan.
2011, pp. 5997–6000.
[5] W. C. Warger II, J. A. Newmark, B. Zhao, C. M. Warner, and C. A.
DiMarzio, “Accurate cell counts in live mouse embryos using optical
quadrature and differential interference contrast microscopy,” in Pro.
of SPIE, J.-A. Conchello, C. J. Cogswell, and T. Wilson, Eds., Feb.
2006, pp. 609 009–12.
[6] D. M. Pelikan, S. a. Scherjon, W. E. Mesker, G. M. de Groot-
Swings, G. G. Brouwer-Mandema, H. J. Tanke, and H. H. Kanhai,
“Quantiﬁcation of fetomaternal hemorrhage: a comparative study of
the manual and automated microscopic Kleihauer-Betke tests and ﬂow
cytometry in clinical samples.” American journal of obstetrics and
gynecology, vol. 191, no. 2, pp. 551–7, Aug. 2004.
[7] D. Huh, W. Gu, Y . Kamotani, J. B. Grotberg, and S. Takayama,
“Microﬂuidics for ﬂow cytometric analysis of cells and particles.”
Physiological measurement, vol. 26, no. 3, pp. R73–98, June 2005.
[8] Y . Mundee, N. C. Bigelow, B. H. Davis, and J. B. Porter, “Simpliﬁed
ﬂow cytometric method for fetal hemoglobin containing red blood
cells.” Cytometry, vol. 42, no. 6, pp. 389–93, Dec. 2000.
[9] J. D. Hoyer, C. S. Penz, V . F. Fairbanks, C. a. Hanson, and J. a.
Katzmann, “Flow cytometric measurement of hemoglobin F in RBCs:
diagnostic usefulness in the distinction of hereditary persistence of
fetal hemoglobin (HPFH) and hemoglobin S-hPFH from other con-
ditions with elevated levels of hemoglobin F.” American journal of
clinical pathology, vol. 117, no. 6, pp. 857–63, June 2002.
[10] D. M. V . Pelikan, W. E. Mesker, S. a. Scherjon, H. H. H. Kanhai, and
H. J. Tanke, “Improvement of the Kleihauer-Betke test by automated
detection of fetal erythrocytes in maternal blood.” Cytometry. Part B,
Clinical cytometry, vol. 54, no. 1, pp. 1–9, July 2003.
[11] R. Rodr´ ıguez, T. E. Alarc´ on, and O. Pacheco, “A new strategy to
obtain robust markers for blood vessels segmentation by using the
watersheds method.” Computers in biology and medicine, vol. 35,
no. 8, pp. 665–86, Oct. 2005.
[12] C. Chen, W. Wang, J. A. Ozolek, and G. K. Rohde, “A ﬂexible
and robust approach for segmenting cell nuclei from 2D microscopy
images using supervised learning and template matching.” Cytometry.
Part A, vol. 83, no. 5, pp. 495–507, May 2013.
[13] M. Datar, D. Padﬁeld, and H. Cline, “Color and texture based
segmentation of molecular pathology images using HSOMS,” in 2008
5th IEEE International Symposium on Biomedical Imaging: From
Nano to Macro. IEEE, May 2008, pp. 292–295.
[14] G. Ramsey, “Inaccurate doses of Rh immune globulin after Rh-
incompatible fetomaternal hemorrhage: survey of laboratory practice.”
Archives of pathology & laboratory medicine, vol. 133, no. 3, pp. 465–
9, Mar. 2009.
[15] M. Farhan, O. Yli-Harja, and A. Niemist¨ o, “An improved clump
splitting method for convex objects,” in Proceedings of the 7th
Workshop on Computational Systems Biology, 2010, pp. 35–38.
[16] J. Shi and J. Malik, “Normalized cuts and image segmentation,” IEEE
Transactions on Pattern Analysis and Machine Intelligence, vol. 22,
no. 8, pp. 888–905, 2000.
[17] K. R. Zalik and B. Zalik, “Validity index for clusters of different sizes
and densities,” Pattern Recognition Letters, vol. 32, no. 2, pp. 221–
234, Jan. 2011.
[18] A. Fitzgibbon, M. Pilu, and R. Fisher, “Direct least square ﬁtting
of ellipses,” IEEE Transactions on Pattern Analysis and Machine
Intelligence, vol. 21, no. 5, pp. 476–480, May 1999.
1711
