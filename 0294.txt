  
? 
Abstract—Some refineries need to process both low and high 
fusion point crude oil. Often storage tanks are located at two 
geographically different sites, one for low fusion point crude oil 
and the other for high one. With two storage sites, two pipelines 
are needed to transport different types of crude oil. It is difficult 
to enforce the constraints resulting from high fusion point oil 
transportation. Reducing such transportation cost is among the 
most important goals sought by refinery industry. This work for 
the first time studies this scheduling problem from a 
control-theoretic viewpoint. Due to the hybrid property of the 
process, the system is modeled by a hybrid Petri net. With this 
model, an efficient method is presented to schedule the 
transportation of high fusion point crude oil. 
I. INTRODUCTION 
Due to the NP-hard nature for short-term scheduling of 
process industry [1], it is very challenging to schedule oil 
refining operations [9]. According to [9], the crude oil 
scheduling problem is one of the most challenging ones in an 
oil refinery plant. Scheduling crude oil operations needs to 
sequence not only the jobs, but also define them. Thus, 
heuristic and mate-heuristic methods that used in discrete 
production scheduling, such as genetic algorithm (GA), are 
very difficult to be applied if not impossible. One way to do so 
is to develop mathematical programming models and their 
solution. There are mainly two categories of such models: 
discrete-time and continuous-time ones. The former divides a 
scheduling horizon into a number of intervals with uniform 
time durations. An event, such as start and end of an operation, 
should happen at the boundary of a time interval. Then, an 
exact solution method is used to obtain an optimal short-term 
schedule [5, 7, 8, 13]. By such models, the uniform interval 
must be small enough so as to obtain acceptable accuracy. 
This often leads to an unmanageable number of binary 
variables for real-world applications, thereby making the 
problem or even impossible to solve [1, 10]. Continuous-time 
models are proposed as an alternative in [2-4] to reduce the 
number of discrete variables. With them, although the number 
of discrete variables is significantly reduced, one must handle 
nonlinear constraints [6]. Also, they need to know the number 
of discrete events that occur during the scheduling horizon, 
which is not the case in most industrial setting and thus 
 
*This work is partly supported by National Natural Science Foundation of 
China under Grant 61273036, the NSF of USA under Grant CMMI-1162482 
and Science and Technology Development Fund of Macau under Grant 
065/2013/A2. 
N. Q. Wu and L. P. Bai are with the Faculty of Information Technology, 
Macau University of Science and Technology, Macau and also the 
Department of Industrial Engineering, Guangdong University of Technology, 
Guangzhou 510006, China (e-mail: nqwu@must.edu.mo and 
bailp@gdut.edu.cn). 
M. C. Zhou is with the Department of Electrical and Computer 
Engineering, New Jersey Institute of Technology, Newark, NJ 07102-1982 
USA (e-mail: zhou@njit.edu).  
iterative methods are necessary to determine such a number 
[1], thereby requiring prohibitive computation. 
To make the problem solvable, all the mathematical 
models make special assumptions, which, unfortunately, make 
the solution inefficient or unrealistic for real world cases. 
Moreover, they often ignore critical constraints, i.e. oil 
residency time and high-fusion-point crude oil (H-oil for short) 
transportation constraints. This leads their solutions to be 
infeasible. Hence, one must search for other innovative 
methods. 
From a control theory perspective, our prior work [11] can 
decompose the problem into two sub-problems in a 
hierarchical way. At the upper level, it finds a refining 
schedule to achieve such performance objectives as the 
minimum crude oil inventory and maximal productivity 
without generating a detailed schedule. At the lower level, it 
finds a detailed schedule to realize a given refining one. This 
eases the original short-term scheduling problem drastically. 
In many refineries, all the types of crude oil are unloaded 
into their storage tanks first and then delivered to the charging 
tanks. There is only a pipeline used to transport crude oil from 
the former to the latter. Scheduling analysis is made for cases 
with and without H-oil [10, 11]. 
Crude oil
tanker
Storage 
tanks
Pipeline #2
Charging 
tanks
Distillers
Other
production
units
Blend
header
Finished
products
Crude oil operations Production
Pipeline #1
Site #2
Site #1
 
Figure 1. The illustration of 2-pipeline oil refinery process 
For many other cases, due to the special requirement for 
H-oil unloading from a tanker, the storage tanks are located at 
two geographically different sites, as shown in Fig. 1. The 
tanks at Site #1 are used for the storage of crude oil with low 
fusion point oil, L-oil for short, and the ones at Site #2 are for 
H-oil. Pipeline #1 is used for the transportation of L-oil at Site 
#1 to charging tanks, while Pipeline #2 for the transportation 
of H-oil at Site #2. To transport H-oil, Pipeline #2 should be 
heated first by using hot L-oil that flows from charging tanks 
to storage tanks. After the transportation of a parcel of H-oil, 
Pipeline #2 goes to an idle state. However, H-oil cannot stay in 
the pipeline without flowing, since otherwise it would be 
frozen and block the pipeline. We call this requirement an 
H-oil transportation constraint. Thus, it is necessary to send a 
certain amount of L-oil from the storage tanks to the pipeline 
such that H-oil in the pipeline can go out of the pipeline. 
Control-Theoretic and Model-Based Scheduling of Crude Oil 
Transportation for Refinery Industry* 
NaiQi Wu, Senior Member, IEEE, MengChu Zhou, Fellow, IEEE, and LiPing Bai 
2014 IEEE International Conference on Robotics & Automation (ICRA)
Hong Kong Convention and Exhibition Center
May 31 - June 7, 2014. Hong Kong, China
978-1-4799-3684-7/14/$31.00 ©2014 IEEE 3273
  
Clearly, the oil flow in this pipeline is bidirectional. Hence, 
some charging tanks should be reserved for oil transportation 
but not for charging which requires more charging tanks. To 
reduce the operational cost, it needs to transport a type of H-oil 
in storage tanks at a time to the refinery plant with a single 
setup. The question is whether this requirement can be met. 
Up to now, there is no rigorous research to answer it for such 
material flow in a refinery. This motivates us to conduct this 
study to answer this important question. 
Next we introduce the short-term scheduling problem 
addressed in this paper. Then, Section III presents a hybrid PN 
to describe it. With the model, Section IV conducts scheduling 
analysis and proposes a control-theoretic scheduling method 
for the first time. Conclusions are given in Section V. 
II. PROBLEM STATEMENT 
A. Crude Oil Operations 
At the crude oil operation stage, crude oil is carried to a 
dock near the refinery plant by tankers, where it is unloaded 
into storage tanks. It is then transported to charging tanks in 
the refinery plant via pipelines. The charging tanks are used to 
feed distillers for distillation. 
Crude oil is normally unloaded into only an empty storage 
tank unless the same type of crude oil is in it. After a storage or 
charging tank is charged, before the crude oil in it can be 
discharged, it must stay in it for a certain amount of time. This 
time delay is called oil residency time (RT). Usually, a 
pipeline takes tens of kilometers long with capacity of tens of 
thousand cubic meters. It is full of oil all the time and cannot 
be emptied. Crude oil in it should be taken as inventory and 
cannot be simply neglected. At each site, there are a number of 
crude oil types to be processed. These types of oil are 
delivered from storage tanks to charging ones via a pipeline. 
Hence, it needs to switch from one type of oil to another from 
time to time. There may be a number of crude oil segments of 
different types that stay in a pipeline or are flowing through it. 
When crude oil is transported, the pipeline can feed one 
charging tank at a time. Besides, a tank cannot receive and 
send oil simultaneously. 
Due to its transportation constraint, H-oil’s transportation 
cost is high. Hence, when it is transported from storage tanks 
at Site #2 to charging tanks, it is desired that it can be 
transported as much as possible, or at least with an expected 
amount by a single setup. 
In summary, scheduling such a system is subject to the 
following resource and process constraints. The former 
include: 1) the limited number and capacity of storage and 
charging tanks; 2) the limited flow rate of oil unloading and oil 
transportation through the pipelines; and 3) existence of 
various crude oil types in storage and charging tanks, and in 
coming tankers. The latter include: 1) a distiller kept in 
working all the time uninterruptedly; 2) at least one charging 
tank dedicated to feed a distiller at any time; 3) no 
simultaneous charging and discharging of a tank; 4) oil 
residency time constraints after charging; and 5) H-oil 
transportation constraint must. 
B. Short-Term Scheduling Problem 
To describe a short-term schedule from a control-theoretic 
perspective, we first introduce the concept of an operation 
decision (OD). 
Definition 2.1: OD = (COT, ?, S, D, INT = [a, b]) is defined 
as an operation decision, where COT = crude oil type; ? = 
volume of crude oil to be unloaded from a tanker to a storage 
tank, or transported from a source tank to a destination one, or 
fed from a charging tank to a distiller; S = the source; D = the 
destination; and INT is a time interval in which a and b are the 
start and end time points of the operation. 
The flow rate in delivering crude oil during [a, b] can be 
kept as a constant for a single operation. Thus, given volume ? 
and time interval [a, b] in an OD, ?/(b - a) is determined and 
used as its flow rate. 
Four types of ODs are identified, i.e., crude oil unloading, 
L and H-oil transportation, and feeding, denoted by ODU, 
ODL, ODH, and ODF, respectively, and their time interval is 
denoted as [?, ?], [?, ?], [?, ?], and [?, ?], respectively. For 
ODU, S is a tanker and D is a storage tank. For ODL, S is a 
storage tank at Site #1, D is a charging tank. For ODH, S and D 
can be both storage at Site #2 and charging tanks. For ODF, S 
is a charging tank and D is a distiller. We use ODF
ki
 to denote 
the i-th OD for feeding distiller k for a schedule. To describe a 
short-term schedule, let g = ?/(? - ?), f = ?/(? - ?), r = ?/(? - ?), 
and h = ?/(? - ?) denote flow rates for a tanker unloading, L- 
and H-oil transportation, and distiller feeding decided by ODs, 
respectively. Also let K be the set of distillers. Let [?
0
, ?
1
] be 
the schedule horizon that often lasts for a week or ten days. 
Given the system state at ?
0
, i.e., the inventory of crude oil and 
state of all the devices, and information of tanker arrival, one 
needs to know if there exists a system state at a time point ? ? 
[?
0
, ?
1
] and time interval [?, ?
d
] such that during [?, ?
d
] a 
required amount of H-oil at Site #2 can be transported to the 
charging tanks. Notice that [?, ?
d
] may cross over two schedule 
horizons. Hence, we let ? = [?
0
, ?
2
] = [?
0
, ?
1
]?[?, ?
d
] be the 
schedule duration considered and ?  be the volume of H-oil 
required to be transported. With ?  known, it is useful to 
optimize a refining schedule. We use ST1, ST2, and CT to 
denote the storage tanks at Site #1 and #2, and charging tanks, 
respectively. Then, the short-term scheduling problem is to 
find a series of ODs as follows. 
SCHD = {ODU
1
, …, ODU
W
, ODL
1
, …, ODL
Z
, ODH
1
, …, 
ODH
U
, ODF
1
,…, ODF
K
}                               (2.1) 
Subject to 
?
k1
 = ?
0
, ?
k1
 = ?
k2
, …, ?
k(i-1)
 = ?
ki
, …, and ?
kn
 = ?
2
, for ?k 
? K                                                                      (2.2) 
?i and j with 1 ? i < j ? U such that 
?
?
?
?
?
?
?
? ? ? ?
? ? ? ?
? ? ? ?
? ? ? ?
? ? d j j j i i i
j i
k k
k k k k k k k k
j k i for CT D ST S
ODH D ODH S ODH ODH COT
? ? ? ? ? ? ? ?
? ?
?
, ..., , ,
...
, , 2
, , , ,
1 1
(2.3) 
and the resource and process constraints given in Section 
II.A. 
Constraint (2.2) requires that the schedule should cover the 
entire scheduling duration and a distiller cannot be stopped. 
Constraint (2.3) guarantees that the required amount of H-oil 
is transported by a single setup. 
Because of a number of constraints and the combinatorial 
nature, Problem (2.1) is NP-hard. In fact, it is extremely 
difficult to find a feasible schedule. Notice that an operation 
decision OD in a schedule transfers the system from one state 
3274
  
to another. If a state is reached such that one or more 
constraints are violated, this state is said to be an infeasible 
one. If not infeasible, it is feasible. If a state is feasible itself, 
but no matter what ODs are applied thereafter, the system will 
enter an infeasible state, such a state is called an unsafe state, 
and otherwise it is safe. A safe state guarantees the existence 
of a feasible schedule. Meanwhile, if a criterion to decide if a 
state is safe is known, it is easy to find a feasible schedule in a 
control theoretic perspective. With this idea, we find a 
model-based solution to the scheduling problem. 
III. SYSTEM MODELING BY PETRI NET 
To make scheduling analysis for crude oil operations in a 
control theory perspective, one has to build up a model. 
Because there are both discrete event and continuous variables, 
such a model is hybrid. To describe crude oil operations, we 
use the device models [11] for tanks and Pipeline #1, and 
develop a new hybrid PN for Pipeline #2 and the overall 
model for an entire system. A reader is referred as to [14] for 
the basic knowledge of PN. 
We use both discrete and continuous places transitions. 
Colors are used to identify oil types. Also, the time aspect is 
described. Thus, the PN model is a kind of hybrid 
colored-timed PN (CTPN) defined as CTPN = (P = 
P
D
?P
C
?P
E
, T = T
D
?T
T
?T
C,
 I, O, H, ?, M
0
), where P
D
, P
C
, 
and P
E
 are sets of discrete, continuous, and enforcing places; 
T
D
, T
T
, and T
C
 are sets of discrete, timed, and continuous 
transitions; I: P?T ? {0, 1} and O: P?T ? {0, 1} are input 
and output functions; H: P?T ? {0, 1} is an inhibitor function; 
?(p) and ?(t) represent the color sets of the places in P and 
transitions in T; and M
0
 is the initial marking. We use for 
discrete transition,  for timed transition,  for 
continuous transition,  for continuous place,  for 
discrete place, and  for enforcing place. Then, an overall 
PN model is synthesized via the models for devices. 
A. Models for Tanks and Pipelines 
The PN models for a tank and Pipeline #1 are shown in 
Figs. 2-3, respectively. For detail, please see [11]. 
p
s
p
c
p
3
t
1
t
2
t
3
p
4
 
Figure 2. Petri net for a tank 
The PN model shown in Fig. 4 is newly developed to 
describe the behavior of Pipeline #2 where places p
s1-sk
 are for 
the tanks at Site #2 and p
c1-ck
 for the charging tanks. As the 
model for Pipeline #1 in Fig. 3, continuous places p
1
-p
3
 are 
used to identify crude oil segments of different types in the 
pipeline. Because oil flow through Pipeline #2 bi-directionally, 
continuous transitions z
O1
 to z
Ok
 and x
O1
 to x
Ok
 are used for 
crude oil flowing out of and into the pipeline at the Site #2, 
while z
I1
 to z
Ik
 and x
I1
 to x
Ik
 for crude oil flowing into and out of 
the pipeline at the plant. Transitions z
2
, z
1
, x
2
, and x
1
 are used to 
describe the dynamic behavior of different oil segments in the 
pipeline. Let X
I
 = {x
I1
, …, x
Ik
}, X
O
 = {x
O1
, …, x
Ok
}, Z
I
 = {z
I1
, …, 
z
Ik
}, and Z
O
 = {z
O1
, …, z
Ok
}. 
y
y I1
y Ik
y O1
y Ok
p 1 p 2 p 3 t 1 t 2
t pipeline1
 
Figure 3. Petri net for Pipeline #1, called t
pipeline1
 
x I1
x
x O1
x Ok
p 1 p 2 p 3
p 4
x 1 x 2
t pipeline2
z Ok
z I1
z Ik
z O1
z 1 z 2
z
p s1
p sk
p c1
p ck
p s1
p sk
p c1
p ck
x Ik
 
Figure 4. Petri net for Pipeline #2, called t
pipeline2
 
To describe an H-oil transportation constraint, an 
enforcing place p
4
 is used to connect x
Ii
 and x
Oi
 in the model. 
Every time, a token enters p
3
 by firing a transition in X
I
, a 
token with the same color and volume goes into p
4
 too. When 
there is a token representing an H-oil type in p
4
, it enforces one 
of transition in X
O
 to fire, which requires firing one of 
transitions in X
I
 too. When the token representing an H-oil 
type in a continuous place in the model goes out of it by firing 
a transition in X
O
, the token in p
4
 is removed. In this way, the 
behavior of Pipeline #2 is well modeled. It can be simply 
described by two macro-transitions x and z for different oil 
flowing directions as shown in Fig. 4. Then, a place p in the 
model can be denoted as p(x) or p(z) when the crude oil is 
delivered from storage tanks to charging ones or in the 
opposite direction. 
B. Overall PN Model 
With the device models we develop the overall PN model 
for the system with two storage tanks for each site and two 
charging tanks shown in Fig. 5, where y represents Pipeline #1 
and x and z together represent Pipeline #2. For simplicity, we 
omit the discrete place and its associated arcs, and the inhibitor 
arc in a tank PN model. A storage tank i at Site #1 must be 
discharged via Pipeline #1, it is described by {t
i1
, t
i2
, y, p
is
, p
ic
, 
p
i3
}. A storage tank i at Site #2 must be discharged via Pipeline 
#2. However, it can be charged by a tanker or via Pipeline #2, 
3275
  
as described by {t
i1
, t
i2
, x, p
is
, p
ic
, p
i3
} or {z, t
i2
, x, p
is
, p
ic
, p
i3
}. 
Similarly, a charging tank i is described by {?, t
i1
, ?, p
is
, p
ic
, 
p
i3
}, where ? = y or x when it is charged via Pipelines #1 or #2,; 
and ? = t
i2
 or z when it feeds a distiller or is discharged via 
Pipeline #2. A type of oil from a tanker is modeled by a token 
entering  p
1
 (p
2
) by firing t
1
 (t
2
). 
x
p 3
t 11
t 12
t 21 t 22
t 31 t 32
t 41
t 42
p 1s p 1c
p 2s
p 2c
p 3s
p 4c p 4s
p 1
p 2
t 1
t 2
t 52 t 51
t 62
t 61
p 5s
p 5c
p 6s p 6c
y
z
p 4
p 13
p 23
p 33
p 43
p 53
p 63
t 3
t 4
 
Figure 5. Petri net for the overall system 
C. Transition Enabling and Firing Rules 
Let 
?
t (
?
p) denote the set of input places of transition t 
(input transitions of place p) and t
?
 (p
?
) the set of output 
places of t (output transitions of p). We use M(p) to denote the 
number of tokens in p at M, regardless of the colors of the 
tokens, and M(p, ?
i
) the number of tokens with color ?
i
 in p. 
Further, let V(M(p)) be the token volume (the oil volume) in p 
at marking M. First we define the transition enabling and firing 
rules for discrete transitions. Notice that, in the model, for a 
discrete transition t, we have |
?
t | = | t
?
| = 1. 
Definition 3.1: A discrete transition (including the discrete 
ones in y, x, and z) t with 
?
t = p
i
 and t
?
 = p
j
 is enabled at 
marking M if M(p
i
) ? 1 and M(p
j
) = 0. When t fires, M is 
changed into M' with M'(p
i
) = M(p
i
) – 1 and M'(p
j
) = M(p
j
). 
This definition requires that t's output place be empty, 
which is similar to a finite capacity PN, but the tokens in the 
PN model here may be discrete or continuous. A timed 
transition is used only in the PN for a tank to meet the RT 
constraint before oil in a tank can be discharged. 
Definition 3.2: A timed transition t with its delay ? is 
enabled at marking M if M(p
i
) ? 1, ?p
i
 ? 
?
t. When t starts to 
fire at time ?, M is changed into M' such that: 1) at ?, M'(p
i
) = 
M(p
i
) – 1, if p
i
 ? 
?
t ? P
D
, and M'(p
i
) = M(p
i
) if p
i
 ? 
?
t ? P
C
; 2) 
at time less than ? + ?, M'(p
i
) = M(p
i
), p
i
 ? 
?
t, M'(p
j
) = M(p
j
), 
p
j
 ? t
?
; 3) at? + ?,  M'(p
i
) = M(p
i
) – 1 and V(M'(p
i
)) = 0, ?p
i
 ? 
?
t ? P
C
; and 4) at ? + ?, M'(p
j
) = 1, ?p
j
 ? t
?
 and V(M'(p
j
)) = 
V(M(p
j
)) + V(M(p
i
)), ?p
i
 ? 
?
t, p
j
 ? t
?
, p
i
 ? P
C
, p
j
 ? P
C
, and 
M'(p
j
) = M(p
j
) + 1 if p
j
 ? t
?
 ? P
D
. 
When a timed transition fires, there may be a token in its 
output place p
j
. Then, the token in its input place p
i
 enters p
j
, 
these two tokens merge into one with the volume being their 
sum. 
To distinguish multiple types of crude oil, colors are 
introduced into the model. Let color ? ?? denote a crude oil 
type. A token in place p representing crude oil type i has color 
?
i
 and the volume for this token at M is denoted by V(M(p, ?
i
)). 
A continuous transition must fire with a color. As discussed 
above, the volume of a token in p
3
 in Fig. 2 models the 
capacity of a tank available. Let ? denote the color for such a 
token. Further, let ?
1
? ? be the set of colors for L-oil and 
?
2
? ? be the set of colors for H-oil with ?
1
? ?
2
 = ? and ?
1
 
? ?
2
 ? ?. 
Definition 3.3: A continuous transition (including 
transitions in Y
I
, Y
O
, X
I
, X
O
, Z
I
, and Z
O
 in y, x, and z) t is 
enabled with color ?
i
 at M if 
1) M(p, ?
i
) ? 1 or M(p, ?) ? 1, ?p ? 
?
t; and 
2) If K
j
(p
s
) ? t
?
 for some j, M(K
j
(p
s
), ?
i
) ? 1 or M(K
j
(p
c
), ?
i
) 
? 1, or M(K
j
(p
s
)) = M(K
j
(p
c
)) = 0. 
By 1), we mean that, if p ?P
C
, there must be crude oil with 
a right color or the tank to be charged must not be full. Place p 
?P
E
 implies that firing t consumes a token in p. By 2), we 
mean that the oil in K
j
(p
s
) has color ?
i
 that is same as that in p 
? 
?
t. When a continuous transition t is enabled and triggered 
by an OD, it can then fire. This firing must be associated with 
a flow rate given by this OD, i.e., the flow of oil is governed by 
a flow rate. Assume that t's firing with color ?
i
 begins at time 
?
s
, ends at ?
e
, ??[?
s
, ?
e
], and the flow rate is f. Then, the 
marking changes are defined. 
Definition 3.4: Firing an enabled continuous transition t at 
M transfers the system into M' according to the following 
rules.  
At ?
s
, if p ? 
?
t ? P
D
, M'(p) = M(p) – 1                           (3.1) 
At ?
e
, if p ? t
?
? P
D
, M'(p) = M(p) + 1                          (3.2) 
At ? ? [?
s
, ?
e
], if p ? 
?
t ? P
C
 or p ?P
E
, and M(p, ?
i
) ? 1 
V(M'(p, ?
i
)) = V(M(p, ?
i
)) – (? –?
s
)f                       (3.3) 
If p ? 
?
t ? P
C
, and M(p, ?) ? 1 
V(M'(p, ?)) = V(M(p, ?)) – (? –?
s
)f                       (3.4) 
If p ? t
?
 ? P
C
 or p ?P
E
, and M(p, ?
i
) ? 1 
V(M'(p, ?
i
)) = V(M(p, ?
i
)) + (? – ?
s
)f                     (3.5) 
If p ? t
?
? P
C
 or p ?P
E
, and M(p, ?
i
) = 0 
M'(p, ?
i
) = 1 and V(M'(p, ?
i
)) = (? – ?
s
)f               (3.6) 
With the above PN model, some constraints are 
automatically guaranteed by the transition enabling and firing 
rules, but the first and fifth process constraints are not. Thus, 
liveness of the model is defined and used ensure their 
satisfaction. Let P
dsl
 denote the set of places representing h 
distillers and thus |P
dsl
| = h. 
Definition 3.5: The PN model for the system is said to be 
live if: 
1) At any time ?  for any p
i
 ? P
dsl
, there exists t
i
 ? 
?
p
i
 such 
that t
i
 is firing or enabled and {t
1
}
 
? {t
2
} ?…? {t
h
} = ?; 
and 
2) If M(p
4
(x), ?
i
) > 0, ?
i
 ? ?
2
, and p
4
(x) ? P
E
, at M, there 
exists at least a transition t ? p
4
(x)
?
 such that it is 
enabled or firing. 
By Definition 3.5, a non-live state is an infeasible state 
resulting from an infeasible schedule. Thus, it is necessary to 
schedule crude oil operations such that their PN model is live. 
IV. SCHEDULING H-OIL TRANSPORTATION 
With the proposed PN model and system control theory, 
this work carries out scheduling analysis and discovers the 
conditions under which a short-term schedule can be found 
3276
  
such that the net is live and the amount of H-oil at Site #2 can 
be transported to the charging tanks by a single setup. Let ? 
denote the capacity of Pipeline #2, D
i
 denote distiller i, and ?, 
?, ?, f
dsi
, and ? be the maximal transportation rate of Pipeline 
#1, maximal one of Pipeline #2, minimal one of Pipeline #2, 
feeding rate to distiller DS
i
, and oil residency time, 
respectively, and the amount of oil fed into D
i
 during the oil 
residence time ?
i
 = ? ? f
dsi
. Further, let V
hot
 denote the 
necessary volume of hot oil that flows through Pipeline #2 
satisfying V
hot
 > ?. Because H-oil transportation begins at the 
time when hot oil from the charging tanks stops charging to 
Pipeline #2, we let this time point be ?
0
 and discuss the 
scheduling problem with ?
0
 being the starting time. Because 
the capacity of a pipeline is tens of thousand cubic meters, we 
have ?/? > ? and (V
hot
 + ?)/(2?) > ?. Generally, ?i, we have 
? ? f
dsi
, leading to ? > ? ?? ? f
dsi
 ?? = ?
i
. Among all the 
distillers, a refinery tends to use only one to process H-oil. 
Hence, this work addresses such a case and presents a method 
for the problem with the proofs omitted because of the limited 
space. We have the following result for L-oil transportation. 
Proposition 4.1: For a (K+1)-distiller system with D
1
 - D
K
 
for processing L-oil and D
K+1
 being able to process H-oil, 
assume that: 1) the feeding rate of D
i
, i ? {1, 2, …, K}, for 
crude oil with color ?
i
 ? ?
1
, and f
ds1
 ? …? f
dsK
 and f
dsK
 < f
ds1
 
+ …+ f
ds(K-1)
; 2) there are 3K-1 charging tanks T
1-(3K-1)
 for L-oil 
feeding with T
 3(i-1)+1
, T
 3(i-1)+2
, and T
 3(i-1)+3
 for D
i
, i ? {1, 2, …, 
(K-1)}, and T
 K-2
 and T
 K-1
 for D
K
; 3) initially, the volume of oil 
with color ?
1
 ? ?
1
 in T
 1
, T
 2
, and T
 3
 is ?
1
 = V
hot
 and ?
2
 = ?
3
 
=??
1
 with the oil in T
 1
 is heated, the volume of oil with color 
?
i
 ? ?
1
 in T
 3(i-1)+1
, T
 3(i-1)+2
, and T
 3(i-1)+3
, i ? {2, …, (K-1)}, is 
?
3(i-1)+1
 = ?
3(i-1)+2
 =H?
i
, ?
3(i-1)+3
 = 0, ?
3K-2
 =H?
K
, and ?
3K-1
 = 0, 
and the oil in T
 1
, T
 2
, and T
 3(i-1)+1
, i ? {2, …, K} is ready for 
discharging; and 4) ? ? f
ds1
 + … + f
dsK
. Then, there is a feasible 
schedule for feeding D
i
, i ? {1, 2, …, K}. 
Based on Proposition 4.1, we have derived the following 
result. 
Theorem 4.1: Assume that: 1) the conditions for feeding 
the L-oil processing distillers given in Proposition 4.1 are 
satisfied; 2) there is one distiller D
2
 that is able to process H-oil 
with feeding rate f; 3) there are two charging tanks T
 4
 and T
 5
 
for this distiller with capacities C
4
 and C
5
, respectively; 4) 
initially, the volume of oil with color ?
2
 ? ?
1
 in T
 4
 and T
 5
 are 
?
4
 and ?
5
, respectively, with ?
4
/f ? (V
hot
 + ?)/? and (?
4
 + ?
5
)/f > 
(V
hot
 + ?)/? + ?; and 5) after finishing the oil in T
 4
 and T
 5
, D
2
 
starts processing H-oil with color ?
3
??
2
. Then, the amount of 
H-oil in Site #2 transported into the charging tanks by a single 
setup is ? = max[?((?
4
 + ?
5
)/f - (V
hot
 + ?)/? - ?), C
4
]. 
With two charging tanks T
 4
 and T
 5
, to make RT constraint 
satisfied, 1) T
 4
 is emptied ? time units earlier in feeding D
2
 
before T
 5
 is filled, leading to an interruption of feeding D
2
; or 
2) T
 4
 is emptied in feeding D
2
 and T
 5
 is filled at the same time, 
leading to the interruption of oil flowing in Pipeline #2. It is 
infeasible for both cases.  Thus, at most one tank of H-oil can 
be transported to the charging tanks and it is not economically 
feasible. For the following discussion, we define a tank index 
function as 
?
?
?
?
? ?
?
0 3 mod , 6
0 3 mod , 3 3 mod
) (
i if
i if i
i ?
                     (4.1) 
Let C
max
 = max{C
4
, C
5
, C
6
} and C
min
 = min{C
4
, C
5
, C
6
}. 
We have the following result. 
Theorem 4.2: Assume that: 1) the conditions for feeding 
the L-oil processing distillers given in Proposition 4.1 are 
satisfied; 2) there is one distiller D
2
 for processing H-oil with 
feeding rate f; 3) there are three charging tanks T
 4-6
 for this 
distiller with capacities C
4
, C
5
, and C
6
, respectively; 4) 
initially, the volume of oil with color ?
2
 ? ?
1
 in T
 4
 and T
 5
 are 
?
4
 and ?
5
, respectively, with ?
4
/f ? (V
hot
 + ? + C
6
)/? and (?
4
 + 
?
5
)/f ? (V
hot
 + ? + C
6
)/? + ?, and T
 6
 is empty; 5) C
max
/? ? 
C
min
/f; and 6) after finishing the oil in T
 4
 and T
 5
, D
2
 starts 
processing H-oil with color ?
3
??
2
. Then, there exists a 
feasible schedule such that the amount ? of H-oil in Site #2 
transported into the charging tanks by a single setup can be 
calculated by Algorithm 4.1. 
Algorithm 4.1: Finding the amount of H-oil that can be 
transported into the charging tanks by a single setup 
with three charging tanks 
1) Initialization: ? = (V
hot
 + ? + C
6
)/?, h = ?
4
/f, g = (?
4
 + ?
5
 
+ C
6
)/f, and ? = C
6
. 
2) Filling T
 4
: let i = 4 
a) If ? + C
4
/? + ? ? g, ? = ? + C
4
/?, h = h + ?
5
/f, g = g + 
C
4
/f, ? = ? + C
4
, and i = i + 1. Then, go to 3); 
b) If ? + C
4
/? + ? ? g < ? + C
4
/? + ?, ? = C
4
/(g - ? - ?), 
? = ? + C
4
/?, h = h + ?
5
/f, g = g + C
4
/f, ? = ? + C
4
, 
and i = i + 1. Then, go to 3). 
3) Let j = ?(i) and k = ?(i + 1) 
4) Filling T
 j
 
a) If h ? ? and ? + C
j
/? + ? ? g, ? = ? + C
j
/?, h = h + C
k
/f, 
g = g + C
j
/f, ? = ? + C
j
, and i = i + 1. Then, go to 3); 
b) If h ? ? and ? + C
j
/? + ? ? g < ? + C
j
/? + ? , ? = C
j
/(g 
- ? - ?), ? = ? + C
j
/?, h = h + C
k
/f, g = g + C
j
/f, ? = ? 
+ C
j
, and i = i + 1. Then, go to 3); 
c) If h > ? go to 5). 
5) Return ?. 
To transport H-oil from Site #2 into the charging tanks as 
much as possible by a single setup, it is desirable to charge 
each tank to its full capacity. Assumption (?
4
 + ?
5
)/f ? (V
hot
 + ? 
+ C
6
)/? + ? guarantees that T
 6
 can be charged to its capacity 
when it is charged for the first time. Because of C
max
/? ? C
min
/f, 
if T
 6
 is charged to its capacity for the first time, the following 
tanks can also be charged to their capacity only if they can be 
charged. Thus, assumption (?
4
 + ?
5
)/f ? (V
hot
 + ? + C
6
)/? + ? is 
very important. This implies that we can select appropriate 
states to start the H-oil transportation such that the volume of 
oil transported is maximized. 
Sometimes more H-oil should be transported from Site #2 
to the charging tanks. Thus, more than three charging tanks for 
feeding DS
2
 are necessary and we present the result for the 
four-charging-tank case. For the discussion, we first define 
tank index function as 
?(i) = i mod 4 + 4                                               (4.2) 
Theorem 4.3: Assume that: 1) the conditions for feeding 
the L-oil processing distillers given in Proposition 4.1 are 
satisfied; 2) there is one distiller D
2
 for processing H-oil with 
3277
  
feeding rate f; 3) there are four charging tanks T
 4-7
 for this 
distiller with capacities C
4
 - C
7
, respectively; 4) initially, the 
volume of oil with color ?
2
 ? ?
1
 in T
 4
 and T
 5
 are ?
4
 and ?
5
, 
respectively, with ?
4
/f ? (V
hot
 + ? + C
6
 + C
7
)/? and (?
4
 + ?
5
)/f 
? (V
hot
 + ? + C
6
)/? + ?, and T
 6
 and T
 7
 are empty; 5) C
max
 /? ? 
C
min
 /f; and 6) after finishing the oil in T
 4
 and T
 5
, D
2
 starts 
processing H-oil with color ?
3
??
2
. Then, there exists a 
feasible schedule such that the amount ? of H-oil in Site #2 
transported into the charging tanks by a single setup can be 
calculated by Algorithm 4.2 below. 
Algorithm 4.2: Finding the amount of H-oil that can be 
transported into the charging tanks by a single setup 
with four charging tanks 
1) Initialization: ? = (V
hot
 + ? + C
6
 + C
7
)/?, h = ?
4
/f, g = 
(?
4
 + ?
5
 + C
6
 + C
7
)/f, and ? = C
6
 + C
7
; 
2) Filling T
 4
: let i = 4 
a) If ? + C
4
/? + ? ? g, ? = ? + C
4
/?, h = h + ?
5
/f, g = g 
+ C
4
/f, ? = ? + C
4
, and i = i + 1. Then, go to 3); 
b) If ? + C
4
/? + ? ? g < ? + C
4
/? + ?, ? = C
4
/(g - ? - 
?), ? = ? + C
4
/?, h = h + ?
5
/f, g = g + C
4
/f, ? = ? + 
C
4
, and i = i + 1. Then, go to 3) 
3) Let j = ?(i) and k = ?(i + 1) 
4) Filling T
 j
 
a) If h ? ? and ? + C
j
/? + ? ? g, ? = ? + C
j
/?, h = h + 
C
k
/f, g = g + C
j
/f, ? = ? + C
j
, and i = i + 1. Then, go 
to 3); 
b) If h ? ? and ? + C
j
/? + ? ? g < ? + C
j
/? + ? , ? = 
C
j
/(g - ? - ?), ? = ? + C
j
/?, h = h + C
k
/f, g = g + C
j
/f, 
? = ? + C
j
, and i = i + 1. Then, go to 3); 
c) If h > ? go to 5). 
5) Return ?. 
With four charging tanks for DS
2
, much more H-oil at Site 
#2 can be transported into the charging tanks. With ? 
calculated, we can check if ? ? ?. If so the requirement can be 
met, and otherwise it is not. 
This method has been applied to an industrial case study. 
A refinery has four distillers D
1
-D
4
 with D
2
 being able to 
process H-oil. Initially, there are 11 charging tanks available 
for distiller feeding. The maximal flow rate of Pipeline #1 is ? 
= 1,250 tons/h, and the maximal and minimal flow rates of 
Pipeline #2 are ? = 625 tons/h and ? = 420 tons/h, respectively. 
There is 134,000 tons of H-oil at Site #2 to be transported to 
the charging tans. By using the proposed method, it is verified 
that the conditions given in Proposition 4.1 are met and three 
tanks can be used to feed D
2
. Then, by Theorem 4.2 and 
Algorithm 4.1, a short-term schedule is found and 134,000 
tons of H-oil is able to be transported to the charging tanks by 
a single setup. Such a problem is extremely difficult, even is 
impossible, for an existing method to solve. 
V. CONCLUSION 
Short-term scheduling for crude oil operations in a refinery 
belongs to the so-called NP-hard problems. Besides, 
transportation of H-oil results in high cost because of the 
high-cost setup. Thus, it is desired that the volume to be 
transported by a single setup should be as large as possible. 
With two pipelines, one for L-oil and the other for H-oil 
transportation, the problem is further complicated. There is 
no existing model and method that deal with such issues to the 
best knowledge of the authors. In this work, by modeling the 
system with a hybrid Petri net, the conditions and efficient 
method are presented to obtain a feasible schedule and to 
maximize the amount of H-oil that can be transported. It 
shows that the amount of H-oil that can be transported is 
greatly dependent on the initial state. With a detailed schedule 
obtained, it is necessary to find an optimal refining schedule 
by minimizing crude oil inventory cost, middle and final 
product inventory cost, and maximizing production profit. 
This is our future work. 
REFERENCES 
[1] C. A. Floudas and X. Lin, “Continuous-time versus discrete-time 
approaches for scheduling of chemical processes: a review”, 
Computers and Chemical Engineering, vol. 28, 2109-2129, 2004. 
[2] K. C. Furman, Z. Jia, and M. G. Ierapetritou, A robust event-based 
continuous time formulation for tank transfer scheduling, Industrial 
and Chemical Engineering Research, vol. 46, 9126–9136, 2007. 
[3] Z. Jia and M. Ierapetritou, Efficient short-term scheduling of refinery 
operations based on a continuous time formulation, Computers and 
Chemical Engineering, vol. 28, 1001-1019, 2004. 
[4] R. Karuppiah, K. C. Furmanb, and I. E. Grossmann, Global 
optimization for scheduling refinery crude oil operations, Computers 
and Chemical Engineering, vol. 32, 2745–2766, 2008. 
[5] C. A. Mendez, I. E. Grossmann, I. Harjunkoski, and P. Kabore, A 
simultaneous optimization approach for off-line blending and 
scheduling of oil-refinery operations, Computers and Chemical 
Engineering, vol. 30, no. 4, 614-634, 2006. 
[6] J. M. Pinto, M. Joly, and L. F. L. Moro, “Planning and scheduling 
models for refinery operations,” Computers and Chemical Engineering, 
vol. 24, 2259-2276, 2000. 
[7] G. K. D. Saharidisa, M. Minouxb, and Y. Dallery, Scheduling of 
loading and unloading of crude oil in a refinery using event-based 
discrete time formulation, Computers and Chemical Engineering, vol. 
33, 1413-1426, 2009. 
[8] N. Shah, Mathematical programming techniques for crude oil 
scheduling, Computers and Chemical Engineering, vol. 20, Suppl. 
S1227-1232, 1996. 
[9] N. K. Shah, Z. Li, and M. G. Ierapetritou, Petroleum refining operations: 
key issues, advances, and opportunities, Industrial and Engineering 
Chemical Research, vol. 50, 1161-1170, 2011. 
[10] N. Q. Wu, C. B. Chu, F. Chu, and M. C. Zhou, Schedulability analysis 
of short-term scheduling for crude oil operations in refinery with oil 
residency time and charging-tank-switch-overlap constraints, IEEE 
Trans. on Autom. Sci. and Eng., vol. 8, no. 1, 190-204, 2011. 
[11] N. Q. Wu, F. Chu, C. B. Chu, and M. C. Zhou, Short-term 
schedulability analysis of multiple distiller crude oil operations in 
refinery with oil residency time constraint, IEEE Transactions on 
Systems, Man, & Cybernetics, Part C, vol. 39, no. 1, 1-16, 2009. 
[12] N. Q. Wu, F. Chu, C. B. Chu, and M. C. Zhou, Hybrid Petri net 
modeling and schedulability analysis of high fusion point oil 
transportation under tank grouping strategy for crude oil operations in 
refinery, IEEE Transactions on Systems, Man, and Cybernetics, Part C, 
vol. 40, no. 2, 159-175, 2010. 
[13] U. Yuzgec, A. Palazoglu, and J. A. Romagnoli, Refinery scheduling of 
crude oil unloading, storage and processing using a model predictive 
control strategy, Computers & Chemical Engineering, vol. 34, 
1671-1686, 2010. 
[14] M. C. Zhou and K. Venkatesh, Modeling, Smulation and Control of 
Flexible Manufacturing Systems: A Petri Net Approach, World 
Scientific, Singapore, 1998. 
 
3278
